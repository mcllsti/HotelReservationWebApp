(function(c){function C(a,b,d,e,f,g){if("undefined"!==typeof h[a+w]){var l=c("#"+a+x),p=new k.events.changeData(null,"ItemCreating",b);l.trigger("itemChange",p);if(!0!=p.Cancel){var q=h[a+w],s=h[a+H],n=h[a+I];n.constructor==Array&&(n=n[b]);var t=h[a+D];t.constructor==Array&&(t=t[b]);var p=h[a+E][b].replace(n,q+""),m=h[a+z][b].replace(n,q+""),t=c("#"+t).parent(),u=h[a+A][b].replace(n,q+""),n=h[a+F],r=h[a+J];q++;h[a+w]=q;n&&(document.getElementById(a+K).setAttribute("name",r+B+q+".$"+L),document.getElementById(a+
y+s+"_").setAttribute("name",r+B+q),document.getElementById(a+y+s+G+"_").setAttribute("name",r+B+q+M));t.append(u);null==d?g?m=c(m).prependTo(l):(d=!1,f=c("#"+a+"_Footer"),0<f.length&&(d=!0),m=d?c(m).insertBefore(f):c(m).appendTo(l)):(m=!0!=e?c(m).insertBefore(d):c(m).insertAfter(d),f&&(k.databind.bind(d,m[0]),c(d).remove()));"undefined"!==typeof c&&null!==c&&"undefined"!==typeof c.validator&&null!==c.validator&&"undefined"!==typeof c.validator.unobtrusive&&null!==c.validator.unobtrusive&&jQuery.validator.unobtrusive.parseExt("#"+
m[0].id);jQuery.globalEval(p);m.data("ScriptsRemoved",!0);v(a);n&&c("#"+a+x).sortable("refresh");p=new k.events.changeData(m,"ItemCreated",b);l.trigger("itemChange",p);p=new k.events.changeData(m,"NewHtmlCreated",0);l.trigger("itemChange",p);return m}}}function r(a){var b=a.lastIndexOf("___");if(0>b)return null;a=a.substring(0,b);b=a.lastIndexOf("___");a=a.substring(0,b);return 0>b?null:a}function v(a){if(null!=a){var b=document.getElementById(a+"_ItemsContainer");if(null!=b){0<b.childNodes.length&&
1==b.childNodes[b.childNodes.length-1].nodeType&&""!=b.childNodes[b.childNodes.length-1].outerHTML&&""==b.childNodes[b.childNodes.length-1].id&&(b=b.childNodes[b.childNodes.length-1]);var d=document.getElementById(a+"_Permutation"),e=!1,f=h[a+N];a=h[a+O];for(i=0;i<b.childNodes.length;i++){var g=b.childNodes[i],l=c(g);!0!==l.data("ScriptsRemoved")&&(k.text.collectScriptAndDestroy(g),l.data("ScriptsRemoved",!0));g=b.childNodes[i].getAttribute("id");null!=g&&(l=g.lastIndexOf("_"),0>l||(g=g.substring(l+
1),"Header"!=g&&"Footer"!=g&&(e?(""!=f&&c(b.childNodes[i]).removeClass(f),""!=a&&c(b.childNodes[i]).addClass(a)):(""!=a&&c(b.childNodes[i]).removeClass(a),""!=f&&c(b.childNodes[i]).addClass(f)),e=!e)))}if(null!=d){e="";for(i=0;i<b.childNodes.length;i++)g=b.childNodes[i].getAttribute("id"),f=g.lastIndexOf("___"),f=g.substring(0,f),a=f.lastIndexOf("_")+1,f=f.substring(a),0<i&&(e+=","),e+=f;d.value=e}}}}var F="_CanSort",w="_ElementsNumber",I="_TemplateSymbol",E="_TemplateSript",z="_TemplateHtml",K="_Permutation",
L=".Permutation",y="___",B=".$$",G="_f_ields",M=".f$ields",x="_ItemsContainer",H="_OriginalElementsNumber",D="_TemplateHidden",A="_TemplateHiddenHtml",J="_NamePrefix",N="_Css",O="_AltCss",k=window.mvcct,h=k.pageStatus=k.pageStatus||{},s=k.basicControls=k.basicControls||{};k.html=k.html||{};var u=k.html.sortableList={};s.sortableListItemsContainerPrefix=x;s.sortableListPrepareTemplates=function(a,b){var d=h[a+E]=[];h[a+z]=[];h[a+A]=[];for(var e=0;e<b.length;e++){var f=b[e],g=c("#"+f),l=k.text.collectAllScriptsInelement(f);
d[e]=l;c("#"+f).find("script").remove();l=null;l=g.hasClass("MVCCT_EncodedTemplate")?g.text():c("<div>").append(g.clone()).remove().html();h[a+z][e]=l;g=h[a+D];g.constructor==Array&&(g=g[e]);l=c("<div>").append(c("#"+g).clone()).remove().html();h[a+A][e]=l;c("#"+f).remove()}h[a+F]&&(d=h[a+w],e=document.getElementById(a+y+d),e.setAttribute("id",e.id+"_"),d=document.getElementById(a+y+d+G),d.setAttribute("id",d.id+"_"))};s.sortableListUpdate=function(a,b){if(b==a.parent().attr("id")){var d=a.attr("id");
if(null!=d){d=r(d);v(d);var d=c("#"+d+"_ItemsContainer"),e=new k.events.changeData(a,"ItemMoved",0);d.trigger("itemChange",e)}}};s.updatePermutationsRoot=v;u.addNew=function(a,b,d,c,f){if("string"!=typeof a){a=a.id;var g=a.lastIndexOf("_");a=a.substring(0,g)}C(a,0,b,d,c,f)};u.addNewChoice=C;u.click=function(a,b,d){"string"!=typeof a&&(a=a.id);if(b==k.widgets.manipulationButton.custom)eval(a);else{var e=r(a),f=c("#"+e+x);b==k.widgets.manipulationButton.remove&&(a=c("#"+a),b=new k.events.changeData(a,
"ItemDeleting",0),null==d&&f.trigger("itemChange",b),!0!=b.Cancel&&(a.remove(),v(e),b=new k.events.changeData(a,"ItemDeleted",0),null==d&&f.trigger("itemChange",b)))}};u.move=function(a,b,d){!0!=d?c(a).insertBefore(b):c(a).insertAfter(b);b=r(a.id);v(b);b=c("#"+b+"_ItemsContainer");a=new k.events.changeData(a,"ItemMoved",0);b.trigger("itemChange",a)}})(jQuery);