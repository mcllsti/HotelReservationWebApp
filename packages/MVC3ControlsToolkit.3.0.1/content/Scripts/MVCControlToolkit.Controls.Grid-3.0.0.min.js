(function(f){function T(a,b,c){this.Original=a;this.Current=b;this.ValidationType=c;null!=this.Original&&(a=f(this.Original).attr("data-element-type"),void 0!=a&&null!=a&&(this.ControlType=a,b=this.Original,this.Original="DateTimeInput"==a?K[a].get(b,null):K[a].getString(b)))}function ca(a){this.Names=[];this.Dictionary=[];this.ValidationType=a}function ya(a){var b=null,c=null,c=null,c=a.substring(0,a.lastIndexOf("___")),c=c.substring(0,c.lastIndexOf("___")),c=e[c+da],b=e[a+ea];null==b&&(b=new ca(c),
e[a+ea]=b,c=e[a+L],c.find("input:not([data-elementispart])").each(function(a){b.AddOriginal(this.id,this)}),c.find("textarea:not([data-elementispart])").each(function(a){b.AddOriginal(this.id,this)}),c.find("select:not([data-elementispart])").each(function(a){b.AddOriginal(this.id,this)}),c.find("[data-element-type]").each(function(a){b.AddOriginal(this.id,this)}),c=e[a+w],c.find("input:not([data-elementispart])").each(function(a){b.AddCurrent(this.id,this)}),c.find("textarea:not([data-elementispart])").each(function(a){b.AddCurrent(this.id,
this)}),c.find("select:not([data-elementispart])").each(function(a){b.AddCurrent(this.id,this)}),c.find("[data-element-type]").each(function(a){b.AddCurrent(this.id,this)}),e[a+L]=null);b.Reset();a=e[a+w];a.find(".input-validation-error").removeClass("input-validation-error");a.find(".field-validation-error").removeClass("field-validation-error").addClass("field-validation-valid")}function C(a){var b=null,b=f("#"+a+q+k).detach();0!=b.length&&(e[a+w]=b)}function U(a){var b=null,b=e[a+w];f("#"+a+r+
k).before(b);ya(a)}function z(a,b){var c=a.substring(a.lastIndexOf("___")),e=a.substring(0,a.lastIndexOf("___")),e=e.substring(0,e.lastIndexOf("_")+1);return e+b+c}function fa(a){a=a.substring(0,a.lastIndexOf("___"));a=a.substring(a.lastIndexOf("_")+1);return parseInt(a)}function V(a){var b=a.substring(0,a.lastIndexOf("___")),b=b.substring(0,b.lastIndexOf("___"));if("undefined"!==typeof e[b+I]){var c=fa(a),h=e[b+A],d=e[b+ga];if(!(c<d))if(c!=h)f("#"+a+r+k).css("display","none"),c==h-2&&(c++,a=z(a,
c),V(a));else{var g=f("#"+a+r+k);0!=g.length&&(c<=d?g.css("display",""):(d=z(a,c-1),0!=f("#"+d+r+k).length&&(g.css("display","none"),h--,e[b+A]=h,c--,z(a,c),V(d,b))))}}}function ha(a){a=a.id;var b=a.lastIndexOf("_");if(0>b)return null;a=a.substring(0,b);b=a.lastIndexOf("_");return 0>b?null:a.substring(0,b)+"_Container"}function M(a,b,c){if(c==ia){var h=e[a+N],d=f("#"+a+r+k);if(0!=d.length){c=d.parent();var g=new p.events.changeData(d,"ItemDeleting",0);c.trigger("itemChange",g);!0!=g.Cancel&&(null!=
h?(d.before(h.clone(!0)),d.detach()):d.css("display","none"),C(a),f("#"+b).val("True"),e[a+x]=!0,g=new p.events.changeData(d,"ItemDeleted",0),E(a),c.trigger("itemChange",g))}}else if(c==ja)d=f("#"+a+r+k),0!=d.length&&(c=d.parent(),g=new p.events.changeData(d,"ItemGoingEdit",0),c.trigger("itemChange",g),!0!=g.Cancel&&(U(a),d.detach(),f("#"+b).val("True"),E(a),g=new p.events.changeData(f("#"+a+q+k),"ItemGoneEdit",0),c.trigger("itemChange",g)));else if(c==ka){if(d=f("#"+a+r+k),0!=d.length&&(c=d.parent(),
g=new p.events.changeData(null,"ItemCreating",0),c.trigger("itemChange",g),!0!=g.Cancel)){U(a);d.detach();f("#"+b).val("True");b=a.substring(0,a.lastIndexOf("___"));b=b.substring(0,b.lastIndexOf("___"));if("undefined"!==typeof e[b+I]){var l=fa(a),h=e[b+A];if(l==h)if(d=e[b+I],d==l){l++;var g=l+"",m=e[b+la],O=e[b+W].replace(m,g),t=e[b+X].replace(m,g),P=f("<div>").append(f("#"+e[b+ma]).clone()).remove().html().replace(m,g),w=e[b+na],F=f("<div>").append(f("#"+w).clone()).remove().html().replace(m,g),
D=f("#"+a+q+k).parent();f(O).appendTo(D);f(t).appendTo(D);jQuery.globalEval(e[b+Y].replace(m,g));O=f("#"+w).parent();O.append(F);O.append(P);P=z(a,l)+q+k;l=z(a,l)+r+k;"undefined"!==typeof f&&null!==f&&"undefined"!==typeof f.validator&&null!==f.validator&&"undefined"!==typeof f.validator.unobtrusive&&null!==f.validator.unobtrusive&&jQuery.validator.unobtrusive.parseExt("#"+P);l=new p.events.changeData(f("#"+l),"NewHtmlCreated",0);D.trigger("itemChange",l);l=new p.events.changeData(f("#"+P),"NewHtmlCreated",
0);D.trigger("itemChange",l);l=f.extend({},e[b+oa]);l.itemRoot=l.itemRoot.replace(m,g);l.itemChanged&&(l.itemChanged=l.itemChanged.replace(m,g));pa(l);h++;d++;e[b+A]=h;e[b+I]=d}else l++,h=z(a,l),d=e[h+y],f("#"+h+r+k).replaceWith(d),e[b+A]=l}E(a);g=new p.events.changeData(f("#"+a+q+k),"ItemCreated",0);c.trigger("itemChange",g)}}else c==Z?(d=f("#"+a+q+k),0!=d.length&&(c=d.parent(),g=new p.events.changeData(d,"ItemUndoing",0),c.trigger("itemChange",g),!0!=g.Cancel&&(g=e[a+y],d.before(g),C(a),f("#"+b).val("False"),
V(a),E(a),a=f("#"+a+r+k),g=new p.events.changeData(a,"ItemUndone",0),c.trigger("itemChange",g)))):c==qa?(d=f("#"+a+q+k),0!=d.length&&(c=d.parent(),g=new p.events.changeData(d,"ItemResetting",0),c.trigger("itemChange",g),!0!=g.Cancel&&(g=e[a+y],f("#"+a+q+k).before(g),C(a),U(a),f("#"+a+r+k).detach(),E(a),g=new p.events.changeData(d,"ItemReset",0),c.trigger("itemChange",g)))):c==$&&(h=e[a+N],d=null!=h?f("#"+a+ra+k):f("#"+a+r+k),0!=d.length&&(c=d.parent(),g=new p.events.changeData(null,"ItemUndeleting",
0),c.trigger("itemChange",g),!0!=g.Cancel&&(g=e[a+y],null!=h?(d.before(g),d.remove()):d.css("display",""),e[a+x]=!1,f("#"+b).val("False"),E(a),g=new p.events.changeData(f("#"+a+r+k),"ItemUndeleted",0),c.trigger("itemChange",g))))}function sa(a,b,c,h){b=p.text.collectAllScriptsInelement(a+q+k)+p.text.collectAllScriptsInelement(a+r+k);e[h+Y]=b;b=f("#"+a+q+k);a=f("#"+a+r+k);b.find("script").remove();a.find("script").remove();c=null;c=b.hasClass("MVCCT_EncodedTemplate")?b.text():f("<div>").append(b.clone()).remove().html();
e[h+X]=c;c=a.hasClass("MVCCT_EncodedTemplate")?a.text():f("<div>").append(a.clone()).remove().html();e[h+W]=c;b.remove();a.remove()}function E(a){a=a.substring(0,a.lastIndexOf("___"));a=a.substring(0,a.lastIndexOf("___"));aa(a)}function aa(a){var b=e[a+ba];if(null!=b){var c=e[a+ta];a=e[a+ua];var h=!1;for(i=0;i<b.childNodes.length;i++){var d=b.childNodes[i].id;if(null!=d){var g=d.lastIndexOf("_");0>g||d.substring(g)!=k||"none"==f(b.childNodes[i]).css("display")||(h?(""!=c&&f(b.childNodes[i]).removeClass(c),
""!=a&&f(b.childNodes[i]).addClass(a)):(""!=a&&f(b.childNodes[i]).removeClass(a),""!=c&&f(b.childNodes[i]).addClass(c)),h=!h)}}}}function va(a,b,c,h){var d=e[h+Q]||[];d.push(a);e[h+Q]=d;f("#"+a+wa+k).find("script").remove();d=f("#"+a+wa+k).detach();f("#"+a+q+k).find("script").remove();0==d.length&&(d=f("#"+a+q+k).clone(!0));d.css("display","");e[a+L]=d;d=f("#"+a+r+k);d.find("script").remove();var g=d.parent();0<g.length&&(g=g[0],e[h+ba]=g);e[a+y]=d;d.css("display","");d=f("#"+a+za+k);d.find("script").remove();
d=d.detach();d.css("display","");null!=d&&0==d.size()&&(d=null);e[a+R]=d;h=f("#"+a+ra+k);h.find("script").remove();d=h;null!=d&&0==d.size()&&(d=null);e[a+N]=d;c?(c=f("#"+a+q+k),C(a),c.css("display",""),null==d?f("#"+a+r+k).css("display","none"):(f("#"+a+r+k).detach(),h.css("display","")),e[a+x]=!0):(h=h.detach(),h.css("display",""),c=f("#"+a+q+k),e[b+xa]?(C(a),f("#"+a+r+k).css("display","")):f("#"+a+r+k).detach(),c.css("display",""),e[a+x]=!1)}function pa(a){e[a.itemChanged+xa]=a.changedValue;m.replace(a.itemRoot+
L,null);m.replace(a.itemRoot+w,null);m.replace(a.itemRoot+y,null);m.replace(a.itemRoot+N,null);m.replace(a.itemRoot+R,null);va(a.itemRoot,a.itemChanged,a.deleted,a.root)}function S(a,b){var c=e[b+"_True"];void 0===c&&(c=a);var h=f("#"+b);0==h.length&&(h=f("#"+b+"___Hidden"));return c=h.data("_True")||c}function F(a,b){var c=e[b+"_Format"];void 0===c&&(c=a);(c=f("#"+b+"___Hidden").data("_Format")||c)&&0<c.length&&"<"==c.substring(0,1)&&(c=f("#"+b+"_Format").text(),f("#"+b+"_Format").remove());var h=
document.getElementById(b+"_hidden");null!=h&&(c=h.value);return c}var Z="DataButtonCancel",ia="DataButtonDelete",$="DataButtonUndelete",ja="DataButtonEdit",ka="DataButtonInsert",qa="DataButtonResetRow",r="_Display",q="_Edit",wa="_OldEdit",ra="_Undelete",za="_ChangedExternally",L="_Save",w="_SaveCurr",ea="_Datagrid_Fields",y="_SaveD",N="_SaveU",R="_SaveC",x="_Deleted",k="_Container",xa="_Var",Q="_AllNormal",oa="_templatePrepare",na="_placeHolder",ma="_changedHidden",la="_templateSymbol",I="_lastIndex",
da="_validationType",ga="_minLastIndex",A="_lastVisibleIndex",X="_editHtml",W="_displayHtml",Y="_allJavascript",ta="_Css",ua="_AltCss",ba="_FatherItems",p=window.mvcct,e=p.pageStatus=p.pageStatus||{},m=p.basicControls=p.basicControls||{};p.html=p.html||{};var K=p.widgets,t=p.html.trackedGrid={};T.prototype={Original:null,Current:null,ControlType:null,ValidationType:null,Reset:function(){if(null!=this.Original&&null!=this.Current)if(null!=this.ControlType){var a=this.Current,b=this.ControlType,c=this.Original;
"DateTimeInput"==b?K[b].set(a,c,null,null):K[b].setString(a,c)}else{if("input"==this.Original.nodeName.toLowerCase())if(a=this.Original.getAttribute("type").toLowerCase(),"checkbox"==a||"radio"==a)this.Current.checked=this.Original.checked;else{if("file"!=a&&"button"!=a&&"reset"!=a&&"submit"!=a&&"image"!=a)try{this.Current.value=this.Original.value}catch(e){}}else"textarea"==this.Original.nodeName.toLowerCase()?this.Current.value=this.Original.value:"select"==this.Original.nodeName.toLowerCase()&&
f(this.Current).html(f(this.Original).html());m.refreshWidget(this.Current)}}};ca.prototype={Names:null,Dictionary:null,ValidationType:null,AddOriginal:function(a,b){"undefined"===typeof this.Dictionary[a]?(this.Names.push(a),this.Dictionary[a]=new T(b,null,this.ValidationType)):this.Dictionary[a].Original=b},AddCurrent:function(a,b){"undefined"===typeof this.Dictionary[a]?(this.Names.push(a),this.Dictionary[a]=new T(null,b,this.ValidationType)):this.Dictionary[a].Current=b},Reset:function(){for(var a=
null,b=0;b<this.Names.length;b++)a=this.Names[b],"undefined"!==typeof this.Dictionary[a]&&this.Dictionary[a].Reset()}};t.dataButtonCancel=Z;t.dataButtonDelete=ia;t.dataButtonUndelete=$;t.dataButtonResetRow=qa;t.dataButtonEdit=ja;t.dataButtonInsert=ka;t.dataButtonClick=function(a,b){"string"!=typeof a&&(a=ha(a));var c=a.lastIndexOf("_");if(0>c)return null;a=a.substring(0,c);c=a.lastIndexOf("_");if(0>c)return null;c=a.substring(0,c)+"_Changed";M(a,c,b)};m.displayPostfix=r;m.editPostfix=q;m.savePostFixCurr=
w;m.containerPostFix=k;m.gridItemName=ha;m.dataButtonClick=M;m.dataGridPrepareTemplate=sa;m.dataGridApplyStyles=aa;m.dataGridPrepareItem=va;m.dataGridTemplate=function(a,b,c,h,d,g,l,k,m){e[d+na]=g;e[d+ma]=c;e[d+la]=l;e[d+I]=k;e[d+A]=k;e[d+ga]=m;e[d+X]=null;e[d+W]=null;e[d+Y]=null;e[d+oa]={itemRoot:b,itemChanged:c,changedValue:a,deleted:h,root:d};f(document).ready(function(){sa(b,c,h,d)})};m.dataGridAddItem=function(a,b,c,f,d){e[d+"_itemsData"].push({itemRoot:a,itemChanged:b,changedValue:c,deleted:f,
root:d})};m.dataGridOpen=function(a,b,c,f,d){e[a+Q]=null;e[a+da]=b;e[a+ta]=c;e[a+ua]=f;e[a+ba]=null;e[a+"_FieldsToUpdate"]=d;e[a+"_itemsData"]=[]};m.dataGridClose=function(a){f(document).ready(function(){setTimeout(function(){for(var b=e[a+"_itemsData"],c=0;c<b.length;c++)pa(b[c]);delete e[a+"_itemsData"]});setTimeout(function(){aa(a)})})};m.onBeginDetailForm=function(a,b,c,f,d,g){if(!g||g(c)){if(detailBusy=e[a+"_DetailBusy"])return!1;e[a+"_DetailBusy"]=!0;e[a+"_TypeDetail"]=b;if(null!=c)e[a+"_CurrentRow"]=
"Insert"==b?null:c;else return p.unobtrusive.formIsValid(f,d);return!0}};m.onFailureDetailForm=function(a,b,c){"Display"==e[a+"_TypeDetail"]?null!=b&&b():null!=c&&c();e[a+"_DetailBusy"]=!1};m.onSuccessDetailForm=function(a,b,c,h,d,g,l,m){var q=e[a+"_TypeDetail"];l?"Edit"==q&&f("#"+m).html(h):p.text.globalEvalScriptAndDestroy(h.get_updateTarget());"Server"!=g&&p.unobtrusive.prepareAjaxFormClientValidation(d,g);q=e[a+"_TypeDetail"];g=e[a+"_ChangedFieldCss"];h=e[a+"_DeletedRecordCss"];d=!1;l=document.getElementById("IsValid");
null!=l&&"True"==l.value&&(d=!0);l=e[a+"_CurrentRow"];if(d&&("FirstEdit"==q||"Edit"==q||"Display"==q)){m=e[a+"_FieldsToUpdate"].split(",");var w=e[a+"_DetailPrefix"];if(null!=l){var t=l.substring(0,l.lastIndexOf("Value"))+"OldValue",z=!0,A=!0,D=e[l+R],C=!1;null==D?D=e[l+y]:C=!0;for(var G=0;G<m.length;G++){var s=document.getElementById(t+"_"+m[G]),B=document.getElementById(t+"_"+m[G]+"___JSonModel");null==s&&(s=B);null!=s&&(z=!1);var v=null,v=0==w.length?m[G]:t+"_"+m[G],n=document.getElementById(v);
null!=n&&(A=!1);if(null!=s){var u=null,B=null;if(null!=n&&null!=n.getAttribute("type")&&("checkbox"==n.getAttribute("type").toLowerCase()||"radio"==n.getAttribute("type").toLowerCase()))u=null!=n.getAttribute("checked")&&!0==n.checked?"True":"False",B=F(u,v);else if(null==n||null==n.getAttribute("type")||"file"!=n.getAttribute("type").toLowerCase())if(null!=n)try{if(null==n.nodeName||"input"!=n.nodeName.toLowerCase()&&"textarea"!=n.nodeName.toLowerCase())if(null!=n.nodeName&&"select"==n.nodeName.toLowerCase()){var H=
f(n),u=S(H.val(),v);""==u&&(u=null);B=F(H.find("option:selected").text(),v)}else u=S(n.childNodes[0].nodeValue,v),B=F(n.childNodes[0].nodeValue,v);else u=S(n.value,v),B=F(n.value,v)}catch(I){}else u=S(null,v),B=F(null,v);var n=D.find("#"+l+"_Display_"+m[G]),J,x=f(s);if("undefined"!==typeof x.data("originalvalue")){if(J=x.data("originalvalue"),null==J||void 0==J)J=s.value,x.data("originalvalue",s.value)}else J=s.value,x.data("originalvalue",s.value);null!=g&&(null!=u&&J!=u?(n.removeClass(g),n.addClass(g)):
n.removeClass(g));if(null!=u&&s.value!=u&&(s.value=u,0!=n.length))if(s=n.attr("type"),null==s||void 0==s||"checkbox"!=s.toLowerCase()&&"radio"!=s.toLowerCase())if(0<n.filter("img").length){if(s=(s=e[v+"_Url"])||""===s?s:null,null!=s)try{n.attr("src",s),n.attr("alt",B)}catch(K){}}else try{n.html(B)}catch(L){}else"true"==u.toLowerCase()?n.checked=!0:n.checked=!1}}A?(f('input[id^="'+t+'"]').remove(),null!=h&&(H=e[l+y],H.addClass(h),f("#"+l+r+k).replaceWith(H))):!z&&C&&(e[l+y]=e[l+R],H=e[l+y],f("#"+l+
r+k).replaceWith(H));null!=l&&E(l)}}if("Display"==q){if(null!=b)try{b(l,d,q)}catch(M){}}else if(null!=c)try{c(l,d,q)}catch(N){}e[a+"_DetailBusy"]=!1};m.resetAllGrid=function(a){if(a=e[a+Q])for(var b=0;b<a.length;b++){var c=a[b].substring(0,a[b].lastIndexOf("_"))+"_Changed",f=e[a[b]+x];null!=f&&!0==f?M(a[b],c,$):M(a[b],c,Z)}}})(jQuery);