/* ****************************************************************************
*  MvcControlToolkit.Utils-2.4.0.js
* Copyright (c) Francesco Abbruzzese. All rights reserved.
* francesco@dotnet-programming.com
* http://www.dotnet-programming.com/
* 
* This software is subject to the the license at http://www.mvc-controls.com/media/eula.html 
* and included in the license.txt file of this distribution.
* 
* You must not remove this notice, or any other, from this software.
*
* ***************************************************************************/
(function(s){function w(a,b){var d=JSON.stringify(a,function(a,c){if("string"==typeof c){u.lastIndex=0;var d=u.exec(c);d&&(d=parseInt(d[1]),b&&(c=v(new Date(d))),this[a]=c)}return c});b||(d=d.replace(x,"\\/Date($1)\\/"));return d}function v(a,b){function d(a){return 10>a?"0"+a:a}return a.getUTCFullYear()+"-"+d(a.getUTCMonth()+1)+"-"+d(a.getUTCDate())+"T"+d(a.getUTCHours())+":"+d(a.getUTCMinutes())+":"+d(a.getUTCSeconds())+(b?"":"Z")}function t(a,b,d){if(!b)return a;"#"==b.charAt(0)&&(b=b.substring(1),
a=window);a==window&&0<b.length&&"@"==b.charAt(0)&&(b=1<b.length?b.substring(2):"",a=e.utils.currentModel||window);b=b.split(".");if(0==b.length)return a;for(var g=0;g<b.length-1;g++)a=h.utils.unwrapObservable(a[b[g]]);a=a[b[b.length-1]];return d?a:h.utils.unwrapObservable(a)}function y(a,b){return a+""}function z(a,b){return s.toJSON(a)}function A(a,b){return t(a,b)+""}function B(a,b){return s.toJSON(t(a,b))}var e=window.mvcct=window.mvcct||{},h=window.ko;if("undefined"===typeof h||"undefined"===
typeof h.bindingHandlers)h=window.ko={isObservable:function(a){return!1},observable:function(a){return a},observableArray:function(a){return a},applyBindings:function(a,b){},utils:{unwrapObservable:function(a){return a}},mapping:{fromJS:function(a){return a}}};e.utils=e.utils||{};var x=/\\\\\/Date\((\d+)(?:[-+]\d+)?\)\\\\\//ig,u=/\\\/Date\((\d+)(?:[-+]\d+)?\)\\\//ig;e.utils.property=t;e.utils.propertySet=function(a,b,d,g){a==window&&0<b.length&&"@"==b.charAt(0)&&(b=1<b.length?b.substring(2):"",a=
e.utils.currentModel||window);b=b.split(".");for(var c=0;c<b.length-1;c++){var f=h.utils.unwrapObservable(a[b[c]]);f||(f={},a[b[c]]=f);a=f}if(!g&&h.isObservable(a[b[b.length-1]]))a[b[b.length-1]](d);else a[b[b.length-1]]=d};e.utils.propertyComplete=function(a,b,d){b=b.split(/[\[\.\]]+/);for(var g=a,c=e.utils.isArray(g),f=[],m=0;m<b.length;m++)b[m]&&f.push(b[m]);b=f;try{for(m=0;m<b.length;m++)if(b[m]){a=g[c?parseInt(b[m]):b[m]];var l=h.utils.unwrapObservable(a);l||(l={},g[b[m]]=l);g=l;c=e.utils.isArray(g)}return d?
a:g}catch(k){throw"Expression doesnt match data structure";}};e.utils.propertySetComplete=function(a,b,d,g){var c=!1,f=!1,m=!1;2<b.length&&("-"==b.charAt(0)&&(m=!0,b=b.substring(1)),"]-"==b.substring(b.length-2)?(c=!0,b=b.substring(0,b.length-2)):"]+"==b.substring(b.length-2)&&(f=!0,b=b.substring(0,b.length-2)));b=b.split(/[\[\.\]]+/);for(var l=h.utils.unwrapObservable(a),k=e.utils.isArray(l),q=[],n=0;n<b.length;n++)b[n]&&q.push(b[n]);b=q;try{for(n=0;n<b.length-1;n++)if(b[n]){a=l[k?parseInt(b[n]):
b[n]];var r=h.utils.unwrapObservable(a);r||(r={},l[b[n]]=r);l=r;k=e.utils.isArray(l)}if(k){var p=parseInt(b[b.length-1]);m&&(p=l.length-p);0>p&&(p=0);c?a.splice(p,1):f?p>=l.length?a.push(d):a.splice(p,0,d):l[parseInt(b[b.length-1])]=d}else if(!g&&h.isObservable(l[b[b.length-1]]))l[b[b.length-1]](d);else l[b[b.length-1]]=d}catch(s){throw"Expression doesnt match data structure";}};e.utils.createIfNotExists=function(a){a=a.split(".");for(var b=window,d=0;d<a.length-1;d++){var g=h.utils.unwrapObservable(b[a[d]]);
g||(g={},b[a[d]]=g);b=g}b[a[a.length-1]]||(b[a[a.length-1]]={});return b[a[a.length-1]]};e.utils.classof=function(a){return null===a?"null":void 0===a?"undefined":Object.prototype.toString.call(a).slice(8,-1).toLowerCase()};e.utils.isDate=function(a){return"date"===e.utils.classof(a)};e.utils.isFunction=function(a){return"function"===e.utils.classof(a)};e.utils.isObject=function(a){return"object"===e.utils.classof(a)};e.utils.isString=function(a){return"string"===typeof a};e.utils.isGuid=function(a){return"string"===
typeof a&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(a)};e.utils.isArray=function(a){return"array"===e.utils.classof(a)};e.utils.stringify=function(a,b){return w(a,b)};e.utils.ISODate=function(a,b){return v(a,b)};e.utils.idFromName=function(a){return a?a.replace(/[\$\[\]\.]/g,"_"):a};e.utils.changeIndex=function(a,b,d,g){a+="[";b+="[";if(0!==d.indexOf(a))return null;d=d.slice(a.length);a=d.indexOf("]");if(0>=a)return null;var c=d.slice(0,a),c=parseInt(c);if(isNaN(c))return null;c=e.utils.isFunction(g)?
g(c):g;return null===c?null:b+c+d.slice(a)};e.utils.cloneEntity=function(a,b,d){if(!a)return a;var g=h.isObservable(a);a=h.utils.unwrapObservable(a);var c=this.classof(a);if("object"==c){var c={},f;for(f in a)"__ko_mapping__"==f||!h.isObservable(a[f])&&"function"==this.classof(a[f])||(c[f]=this.cloneEntity(a[f],this.isFunction(b)?b(f):b,this.isFunction(d)?d(f):d));return g?h.observable(c):c}if("array"==c){if(!b)return null;c=[];for(f=0;f<a.length;f++)d&&c.push(this.cloneEntity(a[f],b,d)),c.push(a[f]);
return g?h.observableArray(c):c}c=a;return g?h.observable(c):c};e.utils.arrayDiff=function(a,b,d,g,c,f){var m=null,m=d?g?B:A:g?z:y;g=a;a=h.utils.unwrapObservable(a);b=h.utils.unwrapObservable(b);var l=null;if(b)for(var l={},k=0;k<b.length;k++)l[m(b[k],d)]=!0;b=null;if(c)for(c=h.utils.unwrapObservable(c),b={},k=0;k<c.length;k++)b[m(c[k],d)]=c[k];c=[];for(var q=[],k=0;k<a.length;k++){var n=a[k];l&&!l[m(n,d)]?c.push(n):f&&q.push(n);if(b){var r=b[m(n,d)];if(r){e.utils.restoreEntity(r,n,!1);var p=n._oldValue_;
p&&(p=p(),p.ph=!1,p.pph=!1,p.pc=!1,e.utils.restoreEntity(r,p.value,!1));n._modified&&n._modified(!1)}}}if(!l||c.length==a.length)return g;if(h.isObservable(g)){g(c);if(e.ko&&e.ko.unfreeze)for(k=0;k<q.length;k++)e.ko.unfreeze(q[k]);return g}return c};e.utils.updateCopy=function(a){if(!a._oldValue_)return a;var b=a._oldValue_();return e.utils.cloneEntity(a,b.vr,b.ca)};e.utils.restoreEntity=function(a,b,d){var g=h.isObservable(a);a=h.utils.unwrapObservable(a);var c=h.utils.unwrapObservable(b),c=a?this.classof(a):
this.classof(c);if("object"==c)for(var f in a)"__ko_mapping__"==f||!h.isObservable(a[f])&&"function"==this.classof(a[f])||void 0===b[f]&&"ModelPrefix"!=f&&"ModelId"!=f&&"_tag"!=f||(b[f]=this.restoreEntity(a[f],b[f],this.isFunction(d)?d(f):d));else{if("array"==c&&!d)return b;g?b(a):b=a}return b};e.utils.Track=function(a,b,d,g){if(!a._oldValue_){var c={value:e.utils.cloneEntity(a,b,d),vr:b,up:g,ca:d};a._oldValue_=function(){return c}}};e.utils.accept=function(a){a._oldValue_&&(a._oldValue_=!1)};e.utils.undo=
function(a){if(a._oldValue_){var b=a._oldValue_();e.utils.restoreEntity(b.value,a,b.vr)}};e.utils.changed=function(a){if(!a._oldValue_)return!0;var b=a._oldValue_();return e.utils.compareEntities(b.value,a,b.vr,b.ca)};e.utils.compareEntities=function(a,b,d,g){b=h.utils.unwrapObservable(b);a=h.utils.unwrapObservable(a);if(a===b)return!1;var c;c=a?this.classof(a):this.classof(b);if("object"==c){for(var f in a)if("_modified"!=f&&"__ko_mapping__"!=f&&(h.isObservable(a[f])||"function"!=this.classof(a[f]))&&
this.compareEntities(a[f],b[f],this.isFunction(d)?d(f):d,this.isFunction(g)?g(f):g))return!0;return!1}if("array"==c){if(!d)return!1;if(a.length!=b.length)return!0;for(c=0;c<a.length;c++)if(a[c]!=b[c]||g&&this.compareEntities(a[c],b[c],d,g))return!0;return!1}return"date"==c?"date"!=this.classof(b)?!0:a.getTime()!=b.getTime():b!==a};e.utils.cache=function(a){var b=[],d=[],g=0;return{changeSize:function(b){a=b},add:function(c,f){var e=b[c],h=null;if(e)e.invalid=!0,e.key=null,e.value=null;else if(g++,
g>a){for(e=d.pop();e.invalid;)e=d.pop();e&&(delete b[e.key],h=e.value)}e={key:c,value:f,invalid:!1};b[c]=e;d.unshift(e);return h},get:function(a){var f=b[a];if(!f||f.invalid)return null;var e=f.value;f.invalid=!0;f.key=null;f.value=null;f={key:a,value:e,invalid:!1};b[a]=f;d.unshift(f);return e},remove:function(a){var d=b[a];d&&(d.invalid=!0,d.value=null,d.key=null,delete b[a],g--)},clear:function(){b=[];g=0;d=[]},save:function(a,b,g,l){if(d){for(var k=[],q=0;q<d.length;q++)currData=d[q],currData.invalid||
(l?k.push(l(currData)):k.push(currData));d=k;g&&(k=h.mapping.toJS(k));b?sessionStorage.setItem(a,e.utils.stringify(k)):localStorage.setItem(a,e.utils.stringify(k))}},load:function(a,e,m,l){d=e?sessionStorage.getItem(a):localStorage.getItem(a);if(!d)throw"the key: "+a+" was not found";d=s.parseJSON(d);g=d.length;m&&(d=h.mapping.fromJS(d)());b=[];for(a=0;a<d.length;a++)l&&(d[a]=l(d[a])),m&&(d[a].value=h.mapping.fromJS(d[a].value)),b[d[a].key]=b[d[a].value]}}};e.utils.cloneDeep=function(a,b){a=h.utils.unwrapObservable(a);
var d=e.utils.classof(a);if(!a||"object"!=d&&"array"!=d)return a;var g=null,g="array"==d?[]:{};e.utils.copyModel(a,g,b);return g};e.utils.copyModel=function(a,b,d){a=h.utils.unwrapObservable(a);b=h.utils.unwrapObservable(b);var g=e.utils.classof(a);if(a&&("object"==g||"array"==g||"function"==g))for(var c in a)if("__ko_mapping__"!=c&&"ModelPrefix"!=c&&"ModelId"!=c&&"_tag"!=c){var g=h.utils.unwrapObservable(a[c]),f=e.utils.classof(g);if("array"==f){for(var f=[],m=0,l=g.length;m<l;m++){var k=h.utils.unwrapObservable(g[m]),
q=h.isObservable(g[m]),n=null,n=e.utils.classof(k);"object"==n?(n=q?h.observable({}):{},e.utils.copyModel(k,n,d)):"array"==n?(n=q?h.observable([]):[],e.utils.copyModel(k,n,d)):n=q?h.observable(k):k;f.push(n)}if(b[c])if(h.isObservable(b[c]))b[c](f);else b[c]=f;else h.isObservable(a[c])?b[c]=h.observableArray(f):b[c]=f}else if("object"==f)b[c]||(b[c]=h.isObservable(a[c])?h.observable({}):{}),e.utils.copyModel(g,b[c],d);else if("function"!=f)if(b[c])if(h.isObservable(b[c]))b[c](g);else b[c]=g;else b[c]=
h.isObservable(a[c])?h.observable(g):g;else null!=d&&(b[c]=g)}};e.utils.visitModel=function(a,b,d,g,c){null==c&&(c=[],a=h.utils.unwrapObservable(a));var f=e.utils.classof(a);if(a&&"object"==f){var m={};b(c.join("."),a,f,m);if(!m||!m.cancel)for(var l in a)if("__ko_mapping__"!=l&&"ModelPrefix"!=l&&"ModelId"!=l&&"_tag"!=l){var f=h.utils.unwrapObservable(a[l]),k=e.utils.classof(f);if("array"==k){if(g||b(c.join(".")+"."+l,f,k),d)for(k=0;k<f.length;k++)c.push(l+"["+k+"]"),e.utils.visitModel(f[k],b,d,g,
c),c.pop()}else"object"==k?(c.push(l),e.utils.visitModel(f,b,d,g,c),c.pop()):"function"==k||g||(c.push(l),b(c.join("."),f,k,m),c.pop())}}}})(jQuery);