/* ****************************************************************************
* MVCControlToolkit.Controls.Datetime-2.4.5.js
* Copyright (c) Francesco Abbruzzese. All rights reserved.
* francesco@dotnet-programming.com
* http://www.dotnet-programming.com/
* 
* This software is subject to the the license at http://mvccontrolstoolkit.codeplex.com/license  
* and included in the license.txt file of this distribution.
* 
* You must not remove this notice, or any other, from this software.
*
* ***************************************************************************/
(function(f){function $(a,b){null!=document.getElementById(a+"_Year")&&(document.getElementById(a+"_Year").onkeypress=aa,document.getElementById(a+"_Year").onpaste=X,document.getElementById(a+"_Year").ondrop=X,document.getElementById(a+"_Year").onchange=w);null!=document.getElementById(a+"_Month")&&(document.getElementById(a+"_Month").onchange=w);null!=document.getElementById(a+"_Day")&&(document.getElementById(a+"_Day").onchange=w);null!=document.getElementById(a+"_Hours")&&(document.getElementById(a+
"_Hours").onchange=w);null!=document.getElementById(a+"_Minutes")&&(document.getElementById(a+"_Minutes").onchange=w);null!=document.getElementById(a+"_Seconds")&&(document.getElementById(a+"_Seconds").onchange=w);if(b.data("_DateInCalendar")){var c=f("#"+a+"_Calendar"),d=b.attr("data-date-framework");d||(d=ba,b.attr("data-date-framework",d));d==L?(d=c.data("_CalendarOptions"),c.datepicker(d)):d==S?(c.attr("data-date-format",c.data("bootstrapFormat")),c.datepicker().on("changeDate",function(b){V(b.date,
a)})):d==T&&((d=c.attr("data-options"))?(c.removeAttr("data-options"),d=f.parseJSON(d)):d={},d.mode||(d.mode="calbox"),d.overrideDateFormat=c.data("dateboxFormat"),d.closeCallback=function(b){V(b,a)},c.datebox(d))}w(null,a,!0,null,!0);b.data("ready",!0)}function W(a,b,c){if(null!=a){var d=0;if(b!=a.options[0].value||c!=a.options[a.options.length-1].value){var e=a.value;a.options.length=0;var g=parseInt(f(a).attr("data-countstep"))||1;for(i=b;i<=c;i+=g)a.options[d]=10>i?new Option("0"+i,i):new Option(""+
i,i),d++;s(a.id,e)}}}function X(a){a=a?a:window.event?window.event:null;if(null==a)return!0;var b=a.target?a.target:event.srcElement?event.srcElement:null;if(null==b)return!0;if("paste"==a.type)a=window.clipboardData.getData("Text");else if("drop"==a.type)a=a.dataTransfer.getData("Text");else return!0;for(i=0;i<a.length;i++)if(keyCode=a.charCodeAt(i),13!=keyCode&&8!=keyCode&&!(48<=keyCode&&57>=keyCode))return!1;b.value=a;return!1}function aa(a){a=a?a:window.event?window.event:null;if(null==a||null==
(a.target?a.target:event.srcElement?event.srcElement:null))return!0;a=a.charCode||a.initEvent?a.charCode:a.which?a.which:a.keyCode;return 0==a||13==a||8==a||48<=a&&57>=a?!0:!1}function Y(a){Nanno=document.getElementById(a+"_Year").value;Nmese=document.getElementById(a+"_Month").value;Ngiorno=document.getElementById(a+"_Day").value;var b=new Date(Nanno,Nmese-1,Ngiorno),c=f("#"+a+"_Calendar");a=f("#"+a+"_Hidden").attr("data-date-framework");a==L?(a=c.datepicker("option","dateFormat"),null==a&&(a="mm/dd/yy"),
c.datepicker("setDate",f.datepicker.formatDate(a,b))):a==S?c.datepicker("update",b):a==T&&(c.datebox("setTheDate",b),c.trigger("datebox",{method:"doset"}))}function V(a,b){var c=f("#"+b+"_Calendar");if(null!=a){var d=null;if(f("#"+b+"_Hidden").attr("data-date-framework")==L){var e=c.datepicker("option","dateFormat");null==e&&(e="mm/dd/yy");try{d=f.datepicker.parseDate(e,a)}catch(g){d=new Date}var h=c.datepicker("option","minDate"),c=c.datepicker("option","maxDate"),r=null,t=null;null!=h&&(r=f.datepicker.parseDate(e,
h));null!=c&&(t=f.datepicker.parseDate(e,c));null!=r&&d<r&&(d=r);null!=t&&d>t&&(d=t)}else d=a;document.getElementById(b+"_Year").value=d.getFullYear();document.getElementById(b+"_Month").value=d.getMonth()+1;document.getElementById(b+"_Day").value=d.getDate();w(null,b,!0)}}function w(a,b,c,d,e){var g;if(null==b){a=a?a:window.event?window.event:null;if(null==a)return!1;a=a.target?a.target:event.srcElement?event.srcElement:null;if(null==a)return!1;g=a.id.substring(0,a.id.lastIndexOf("_"))}else g=b;
a=f("#"+g+"_Hidden");if(!0!=a.data("Recursive")||d){a.data("Recursive",!0);var h,r,t,H,k,n,D=a.data("_Curr");d=D.getDate();var x=D.getMonth(),y=D.getFullYear(),M=D.getHours(),N=D.getMinutes(),D=D.getSeconds(),p=a.data("_MinDate")||null,l=a.data("_MaxDate")||null,E=a.data("_ClientDynamicMin")||null;E&&(E=E());var u=a.data("_ClientDynamicMax")||null;u&&(u=u());null!=E&&(null==p||E>p)&&(p=null!=l&&E>l?l:E);null!=u&&(null==l||u<l)&&(l=null!=p&&u<p?p:u);var E=document.getElementById(g+"_Year"),u=document.getElementById(g+
"_Month"),F=document.getElementById(g+"_Day"),O=document.getElementById(g+"_Hours"),P=document.getElementById(g+"_Minutes"),Q=document.getElementById(g+"_Seconds");h=E?E.value:y;r=u?u.value:x;t=F?F.value:d;H=null!=O?O.value:M;k=P?P.value:N;n=Q?Q.value:D;n=new Date(h,r-1,t,H,k,n);null!=l&&l<n&&(n=l);null!=p&&p>n&&(n=p);h=n.getFullYear()+"";r=n.getMonth()+1+"";t=n.getDate()+"";H=n.getHours()+"";k=n.getMinutes()+"";n=n.getSeconds()+"";var q,m,z,I,J,A,B,v,G,C,K,R;a.data("_Valid",!0);h=parseInt(h);if(isNaN(h))a.data("_Valid",
!1);else{A=null==l?null:l.getFullYear();B=null==p?null:p.getFullYear();null!=A&&A<h&&(h=A);null!=B&&B>h&&(h=B);if(E&&!a.data("_DateHidden")&&!a.data("_DateInCalendar")&&(v=document.getElementById(g+"_Year"),null!=v&&"SELECT"==v.tagName&&(G=0,B!=v.options[0].value||A!=v.options[v.options.length-1].value))){C=v.value;v.options.length=0;for(i=B;i<=A;i++)v.options[G]=10>i?new Option("   "+i,i):100>i?new Option("  "+i,i):1E3>i?new Option(" "+i,i):new Option(""+i,i),G++;s(v.id,C)}if((null==A||A>=h)&&(null==
B||B<=h))if(v=11,G=0,A==h&&(v=l.getMonth()),B==h&&(G=p.getMonth()),q=parseInt(r),isNaN(q))a.data("_Valid",!1);else{q-=1;G>q&&(q=G);v<q&&(q=v);if((e||y==B||y==A||h==B||h==A)&&u&&!a.data("_DateHidden")&&!a.data("_DateInCalendar")&&(m=G,e=v,null!=u&&(r=0,m!=u.options[0].value||e!=u.options[u.options.length-1].value))){C=u.value;u.options.length=0;for(i=m;i<=e;i++)u.options[r]=new Option(DateTimeMonthes[i],i+1),r++;s(u.id,C)}e=1;m=q+1;r=0==h%4?9==m||4==m||6==m||11==m?30:2==m?29:31:9==m||4==m||6==m||11==
m?30:2==m?28:31;A==h&&v==q&&(r=l.getDate());B==h&&G==q&&(e=p.getDate());m=parseInt(t);if(isNaN(m))a.data("_Valid",!1);else{e>m&&(m=e);r<m&&(m=r);if(F&&!a.data("_DateHidden")&&!a.data("_DateInCalendar")&&(z=e,t=r,null!=F&&(C=0,z!=F.options[0].value||t!=F.options[F.options.length-1].value))){K=F.value;F.options.length=0;for(i=z;i<=t;i++)F.options[C]=10>i?new Option(" "+i,i):new Option(""+i,i),C++;s(F.id,K)}t=0;C=23;A==h&&v==q&&m==r&&(C=l.getHours());B==h&&G==q&&m==e&&(t=p.getHours());z=parseInt(H);
isNaN(z)?a.data("_Valid",!1):(C<z&&(z=C),z<t&&(z=t),O&&W(O,t,C),H=0,K=59,A==h&&v==q&&m==r&&C==z&&(K=l.getMinutes()),B==h&&G==q&&m==e&&t==z&&(H=p.getMinutes()),I=parseInt(k),isNaN(I)?a.data("_Valid",!1):(K<I&&(I=K),H>I&&(I=H),P&&W(P,H,K),k=0,R=59,A==h&&v==q&&m==r&&C==z&&K==I&&(R=l.getSeconds()),B==h&&G==q&&m==e&&t==z&&H==I&&(k=p.getSeconds()),J=parseInt(n),isNaN(J)?a.data("_Valid",!1):(R<J&&(J=R),J<k&&(J=k),Q&&W(Q,k,R))))}}}a.data("_DateInCalendar")&&(k=g,p&&(p=new Date(p.getFullYear(),p.getMonth(),
p.getDate(),0,0,0,0)),l&&(l=new Date(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0,0)),n=f("#"+k+"_Calendar"),k=f("#"+k+"_Hidden").attr("data-date-framework"),k==L?(k=n.datepicker("option","dateFormat"),null==k&&(k="mm/dd/yy"),null!=p?n.datepicker("option","minDate",f.datepicker.formatDate(k,p)):n.datepicker("option","minDate",null),null!=l?n.datepicker("option","maxDate",f.datepicker.formatDate(k,l)):n.datepicker("option","maxDate",null)):k==S?(n.datepicker("setStartDate",p),n.datepicker("setEndDate",
l)):k==T&&(k=new Date,k=(new Date(k.getFullYear(),k.getMonth(),k.getDate(),0,0,0,0)).getTime(),n.datebox({maxDays:l?parseInt((l.getTime()-k)/Z,10):null,minDays:p?-parseInt((p.getTime()-k)/Z,10):null})));l=!1;a.data("_Valid")&&(!0!=c&&(b||y==h&&x==q&&d==m&&M==z&&N==I&&D==J)||(l=!0),y=h,x=q,d=m,M=z,N=I,D=J);if(!l)return a.data("Recursive",!1),!0;a.data("_Curr",new Date(y,x,d,M,N,D));E&&s(g+"_Year",y);u&&s(g+"_Month",x+1);F&&s(g+"_Day",d);a.data("_DateInCalendar")&&Y(g);O&&s(g+"_Hours",M);P&&s(g+"_Minutes",
N);Q&&s(g+"_Seconds",D);b=a.data("_Curr");if((c=f("#"+g+"_Hidden").data("_UpdateList"))&&0!=c.length)for(q=0;q<c.length;q++)w(null,c[q],!0);a.data("_ClientDateChanged")(b.getTime());a.trigger("DateTimeInput_Changed");a.data("Recursive",!1);return!0}}function s(a,b){var c=document.getElementById(a);if("SELECT"==c.tagName){b=parseInt(b);for(var d=c.options.length-1;0<=d;d--)if(parseInt(c.options[d].value)<=b){c.selectedIndex=d;return}c.selectedIndex=0}else{if(null===b||void 0===b)b="";c.value=b}}function U(a,
b,c){var d=f("#"+a+"_Hidden");if(d.data("_Curr")){var e=d.data("_Curr");if(null!=e&&(e=e.getTime(),!(1==c&&b>=e||2==c&&b<=e))){b=new Date(b);c=d.data("_MinDate");e=d.data("_MaxDate");null!=c&&b<c&&(b=c);null!=e&&b>e&&(b=e);if(c=document.getElementById(a+"_Hours")){var e=document.getElementById(a+"_Minutes"),g=document.getElementById(a+"_Seconds");document.getElementById(a+"_Year")&&(s(a+"_Year",b.getFullYear()),w(null,a,!1,!0));document.getElementById(a+"_Month")&&(s(a+"_Month",b.getMonth()+1),w(null,
a,!1,!0));document.getElementById(a+"_Day")&&(s(a+"_Day",b.getDate()),w(null,a,!1,!0));c&&(s(a+"_Hours",b.getHours()),w(null,a,!e,!0));e&&(s(a+"_Minutes",b.getMinutes()),w(null,a,!g,!0));g&&(s(a+"_Seconds",b.getSeconds()),w(null,a,!0,!0))}else document.getElementById(a+"_Year")&&(s(a+"_Year",b.getFullYear()),w(null,a,!1,!0)),document.getElementById(a+"_Month")&&(s(a+"_Month",b.getMonth()+1),w(null,a,!1,!0)),document.getElementById(a+"_Day")&&(s(a+"_Day",b.getDate()),w(null,a,!0,!0));d.data("_DateInCalendar")&&
Y(a)}}}var x=window.mvcct,Z=864E5,T="JQueryMobile",L="JQueryUI",S="Bootstrap",ba=jQuery.fn.datepicker?f.datepicker&&f.datepicker.parseDate?L:S:jQuery.fn.datebox?T:"none",y=x.widgets.DateTimeInput={};y.setString=function(a,b){clientID=a.id.substring(0,a.id.lastIndexOf("_"));var c=null,c=null==b||""==b?new Date:x.globalize.parse(b,MvcControlsToolkit_DataType_DateTime);U(clientID,c.getTime(),3)};y.set=function(a,b,c,d){clientID=a.id.substring(0,a.id.lastIndexOf("_"));if(0!=f("#"+a.id).length&&f("#"+
clientID+"_Hidden").data("_Curr")&&f("#"+clientID+"_Hidden").data("ready")){if(null==b||""==b)b=new Date;U(clientID,b.getTime(),3)}else setTimeout(function(){y.set(a,b,c,d)},0)};y.setById=function(a,b,c,d){if(null==b||""==b)b=new Date;U(a+"__",b.getTime(),3)};y.get=function(a,b){clientID=a.id.substring(0,a.id.lastIndexOf("_"));return f("#"+clientID+"_Hidden").data("_Curr")&&f("#"+clientID+"_Hidden").data("ready")?f("#"+clientID+"_Hidden").data("_Curr"):null};y.getById=function(a,b){return f("#"+a+
"___Hidden").data("_Curr")};y.bindChange=function(a,b){f("#"+a+"___Hidden").bind("DateTimeInput_Changed",b)};y.unbindChange=function(a,b){f("#"+a+"___Hidden").unbind("DateTimeInput_Changed",b)};y.getString=function(a){clientID=a.id.substring(0,a.id.lastIndexOf("_"));return x.globalize.format(f("#"+clientID+"_Hidden").data("_Curr"),"s",MvcControlsToolkit_DataType_DateTime,"","")};x=window.mvcct||{};x.basicControls=x.basicControls||{};x.basicControls.dateInputInitialize=function(a,b,c,d,e,g,h,r,t,s,
k){var n=f("#"+a+"_Hidden");n.data("_Curr",b).data("_Curr",b).data("_MaxDate",c).data("_MinDate",d).data("Recursive",!1).data("_Valid",!0).data("_YearCombo",e).data("_DateHidden",g).data("_DateInCalendar",h).data("_ClientDateChanged",r).data("_ClientDynamicMin",t).data("_ClientDynamicMax",s);f(document).ready(function(){k();$(a,n)})};x.basicControls.calendarInitialize=function(a,b,c,d,e){var g=f("#"+a+"_Calendar");g.data("bootstrapFormat",d);g.data("dateboxFormat",e);b||(g.data("_CalendarText",null),
g.focus(function(){g.data("_CalendarText",this.value)}));g.data("_InLine",b);g.data("_CalendarOptions",c)};x.basicControls.dateTimeInputUpdateFromCalendar=V;x.basicControls.setDateInput=U;x.basicControls.addToUpdateList=function(a,b){if(null!=a&&null!=b){var c=f("#"+a+"_Hidden").data("_UpdateList");c||(c=[],f("#"+a+"_Hidden").data("_UpdateList",c));c.push(b)}}})(jQuery);