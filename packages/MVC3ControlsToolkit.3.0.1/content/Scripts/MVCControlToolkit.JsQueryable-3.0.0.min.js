(function(g){var h=window.mvcct,aa=h.widgets;h.$$={and:"and",or:"or",not:"not",eq:"eq",ne:"ne",gt:"gt",ge:"ge",lt:"lt",le:"le",endswith:"endswith",startswith:"startswith",substringof:"substringof",substringofInv:"substringofInv",notSupported:"ns",encodeCondition:function(g){return"Equal"==g||"1"==g?h.$$.eq:"NotEqual"==g||"2"==g?h.$$.ne:"LessThan"==g||"4"==g?h.$$.lt:"LessThanOrEqual"==g||"8"==g?h.$$.le:"GreaterThan"==g||"16"==g?h.$$.gt:"GreaterThanOrEqual"==g||"32"==g?h.$$.ge:"StartsWith"==g||"64"==
g?h.$$.startswith:"EndsWith"==g||"128"==g?h.$$.endswith:"Contains"==g||"256"==g?h.$$.substringofInv:"IsContainedIn"==g||"512"==g?h.$$.substringof:h.$$.notSupported}};h.Queryable=function(G,b){var n=G||this.$$.and,E=null;return{filterOperator:function(){return n},get:function(){return null},isLocal:function(){return!1},execute:function(b){},getState:function(){return null},setState:function(b){},resetFilter:function(){return this},resetSorting:function(){this.resetSortingInfos();return this},resetPaging:function(){return this},
setSorting:function(b){return this},setFilter:function(b){return this},setPaging:function(b,d){return this},importSorting:function(b){if(null==b||""==b)return this;this.resetSorting();this.resetSortingInfos();b=b.split(";");for(var d=0;d<b.length;d++){var k=b[d].split("#");2>k.length||this.addSort(h.text.trim(k[0]),0<=k[1].indexOf("-"))}return this},importSortingControl:function(b){return b?this.importSorting(g("#"+b+"___SortInfoAsString").val()):this},resetSortingInfos:function(){E=null},getSortingInfos:function(){return E},
importSortingInfos:function(b,d){if(b)return d&&b.container&&h.html&&h.html.sorting.initializeButtons&&(g("#"+b.container).val(b.value),h.html.sorting.initializeButtons(b.func)),this.importSorting(b.value),E=b,this},importPager:function(b,d){if(!b)return this;var k=g("#"+b);this.setPaging(parseInt(k.val()),d);return this},addSort:function(b,d,k){return this},addCondition:function(b,d,k,e,g){return this},addConditionAsString:function(b,d,k,e,g){if(!1===g)return this;k=h.globalize.parse(k,e);(0==e||
4==e&&k||0<e&&4>e&&!isNaN(k))&&this.addCondition(b,d,k,g,e)},open:function(b,d,k){return res},close:function(b){return null==(this.father||null)?this:this.father},selectErrors:function(){},importClauses:function(b,d){if(!b)return this;var k=0,e=!1,l=d||this;for(this.filterOperator()!=h.$$.and&&(l=this.open(h.$$.and,!0));!e;){var m=g("#"+b+"___"+k),c=b+"___"+k+"___";if(0!=m.length){if(m=g("#"+c+"Selected"),0<m.length&&("True"==m.val()||m.prop("checked"))&&(m=h.$$.encodeCondition(g("#"+c+"Condition").val()),
m!=h.$$.notSupported)){var n=g("#"+b+"___"+k+"_f_ields").val().split(",")[0],r=g("#"+c+"Search"),B=null,q=null,c=g("#"+c+"Search[data-element-type], #"+c+"Search_hidden[data-element-type], #"+c+"Search___Hidden[data-element-type]");0<c.length?(q=parseInt(c.attr("data-client-type")||"0"),r=c[0],B=aa[c.attr("data-element-type")].get(r,q),(0==q||4==q&&B||0<q&&4>q&&!isNaN(B))&&l.addCondition(m,n,B,!0,q,"true"==c.attr("data-date-only"))):(B="checkbox"==r.attr("type")?r.prop("checked")?"true":"false":r.val(),
q=parseInt(r.attr("data-client-type")||"0"),l.addConditionAsString(m,n,B,q,!0))}}else e=!0;k++}this.filterOperator()!=h.$$.and&&l.close(!0);return this}}};h.oDataQueryable=function(G,b,n,E){var a="",d="",k="",e=1,l=null,m=null;b=this.Queryable(b,E);n=g.extend({},h.oDataQueryable.DefaulOptions,n);return g.extend({},b,{changeLink:function(c){G=c},get:function(){var c="";n.includeTotalcount&&(""!=c&&(c+="&"),c+="$inlinecount=allpages");""!=a&&(""!=c&&(c+="&"),!0===E&&(c=c+h.$$.not+" ("+a+")"),c+=a);
""!=d&&(""!=c&&(c+="&"),c+=d);""!=k&&(""!=c&&(c+="&"),c+=k);l&&(""!=c&&(c+="&"),c+=l);var b="?"==n.connector&&0<=G.indexOf("?")?"&":n.connector;return c=""!=c?G+b+c:G},declareHeaders:function(c){m=c},execute:function(c,b){var a={url:this.get(),contentType:"application/json",dataType:"text",success:function(b,a,e){b=g.parseJSON(b);c(b,a,e)},error:b},e=null,d=null;h.ko&&h.ko.dynamicTemplates&&h.ko.dynamicTemplates.authorizationManager&&(d=h.ko.dynamicTemplates.authorizationManager())&&(d=d.bearerToken()||
null);m?e=m:d&&(e={Authorization:"Bearer "+d});m&&d&&!e.Authorization&&""!==e.Authorization&&(e.Authorization="Bearer "+d);e&&(a.headers=e);g.ajax(a)},setState:function(c){a=c.f;d=c.s;k=c.p;e=c.page;l=c.params;this.importSortingInfos(c.sortInfos,!0)},getState:function(){return{f:a,s:d,p:k,page:e,params:l,sortInfos:this.getSortingInfos()}},setExtraParams:function(c){l=c},resetFilter:function(){a="";return this},resetSorting:function(){d="";this.resetSortingInfos();return this},resetPaging:function(){k=
"";e=1;return this},setSorting:function(c){d=c;return this},setFilter:function(c){a=c;return this},setPaging:function(c,b){if(null==b||""==b)b=1;k=n.skip+(c-1)*b+"&"+n.top+b;e=c;return this},addSort:function(c,b,a){if(!1===a)return this;c=c.replace(".","/");d=""!=d?d+",":n.orderby;d=d+c+" "+(b?n.desc:n.asc);return this},addStringCondition:function(c,b){if(!1===b||""==c)return this;a=""!=a?a+" "+this.filterOperator()+" ":n.filter;a+=c;return this},addCondition:function(c,b,a,e,d,k){if(!1===e)return this;
b=b.replace(".","/");d||(d=h.utils.isDate(a)?4:h.utils.isString(a)?0:3);null==a?a="null":4==d?a=k?"datetime'"+h.utils.ISODate(new Date(a.getTime()-6E4*a.getTimezoneOffset()),!0)+"'":"datetime'"+h.utils.ISODate(a,!0)+"'":(a+="",0>=d&&(a=h.utils.isGuid(a)?"guid'"+a+"'":"'"+encodeURIComponent(a)+"'"));c==h.$$.substringof||c==h.$$.startswith||c==h.$$.endswith?this.addStringCondition(c+"("+b+","+a+") eq true"):c==h.$$.substringofInv?this.addStringCondition(h.$$.substringof+"("+a+","+b+") eq true"):this.addStringCondition(b+
" "+c+" "+a);return this},open:function(c,b,a){b=g.extend({},n,{connector:"",filter:""});c=h.oDataQueryable("",c,b,a);c.father=this;return c},close:function(c){if(null==(this.father||null))return this;var b=this.get();""!=b&&this.father.addStringCondition("("+b+")",c);return this.father}})};h.oDataQueryable.DefaulOptions={includeTotalcount:!0,connector:"?",skip:"$skip=",top:"$top=",orderby:"$orderby=",filter:"$filter=",desc:"desc",asc:"asc"}})(jQuery);
(function(g){function h(a){return b.utils.isString(a)?a.toLowerCase():"boolean"==typeof a?a?"true":"false":a}function aa(a,d,k){if(a==b.$$.eq)return function(b){return h(property(b,d))==h(k)};if(a==b.$$.gt)return function(b){return h(property(b,d))>h(k)};if(a==b.$$.ge)return function(b){return h(property(b,d))>=h(k)};if(a==b.$$.lt)return function(b){return h(property(b,d))<h(k)};if(a==b.$$.le)return function(b){return h(property(b,d))<=h(k)};if(a==b.$$.ne)return function(b){return h(property(b,d))!=
h(k)};if(a==b.$$.startswith)return function(b){b=h(property(b,d));return null==b||null==k?!1:0==b.indexOf(h(k))};if(a==b.$$.endswith)return function(b){b=h(property(b,d));return null==b||null==k?!1:b.lastIndexOf(h(k))==b.length-k.length};if(a==b.$$.substringof)return function(b){b=h(property(b,d));return null==b||null==k?!1:0<=h(k).indexOf(b)};if(a==b.$$.substringofInv)return function(b){b=h(property(b,d));return null==b||null==k?!1:0<=b.indexOf(h(k))}}function G(b){return g.validator.objectHasErrors(b)}
var b=window.mvcct,n=window.ko;property=b.utils.property;propertySet=b.utils.propertySet;b.localQueryable=function(a,d,k,e){function l(){var b,c=Math.min(r,p.length);c==p.length&&(c-=J,0>c&&(c=0));var a=Math.min(q,p.length-c);r=c;b=[];for(var d=0;d<p.length;d++)b.push(p[d]);0<c&&b.splice(0,c);0==a?b=[]:a<b.length&&b.splice(a,b.length-a);return b}function m(b,c,a){var d=null,d=null!=p?l():b.get()(a);c({TotalCount:p.length,Results:d})}d=b.Queryable(d,k);var c=[],h=[],r=0,B=1,q=5,p=null,A=null,J=5,R=
g.extend({},d,{get:function(){var b=this.getFilter(),c=this.getSorting();return function(a){var d=[];if(null!=b)for(var k=0;k<a.length;k++)b(a[k])&&!a[k]._destroy&&d.push(a[k]);else for(k=0;k<a.length;k++)a[k]._destroy||d.push(a[k]);p=null==c?d:d.sort(c);return l()}},changeSource:function(b){a=b;p=null},isLocal:function(){return!0},getFilter:function(){return 0==c.length?null:this.filterOperator()==b.$$.and?k?function(b){for(var a=!0,d=0;d<c.length;d++)a=a&&c[d](b);return!a}:function(b){for(var a=
!0,d=0;d<c.length;d++)a=a&&c[d](b);return a}:k?function(b){for(var a=!0,d=0;d<c.length;d++)a=a||c[d](b);return!a}:function(b){for(var a=!0,d=0;d<c.length;d++)a=a||c[d](b);return a}},getSorting:function(){return 0==h.length?null:function(b,c){for(var a=0;a<h.length;a++){var d=h[a](b,c);if(0!=d)return d}return 0}},execute:function(b,c,d){if(e){A&&(A.dispose(),A=null);var k=this;A=a.subscribe(function(c){if(a._reference){var d=a._reference(),e=d.action,d=d.reference;delete a._reference;p&&p.splice("before"==
e?r:Math.min(r+q,p.length-1),0,d)}else p=null;m(k,b,c)})}d&&(p=null);m(this,b,n.utils.unwrapObservable(a))},setState:function(b){p=null;c=b.f;h=b.s;r=b.ps;q=b.pt;B=b.page;this.importSortingInfos(b.sortInfos,!0)},getState:function(){return{f:c,s:h,ps:r,pt:q,page:B,sortInfos:this.getSortingInfos()}},resetFilter:function(){c=[];p=null;return this},resetSorting:function(){h=[];p=null;this.resetSortingInfos();return this},resetPaging:function(){r=0;B=1;return this},setSorting:function(b){p=null;h=b;return this},
setFilter:function(b){p=null;c=b;return this},setPaging:function(b,c){if(null==c||""==c)c=1;J=c;r=(b-1)*c;q=c;B=b;return this},addSort:function(c,a,d){if(!1===d)return this;p=null;a?h.push(function(a,d){val1=property(a,c);val2=property(d,c);b.utils.isString(val1)&&(val1=val1.toLowerCase());b.utils.isString(val2)&&(val2=val2.toLowerCase());return val1<val2?1:val2<val1?-1:0}):h.push(function(a,d){val1=property(a,c);val2=property(d,c);b.utils.isString(val1)&&(val1=val1.toLowerCase());b.utils.isString(val2)&&
(val2=val2.toLowerCase());return val1<val2?-1:val2<val1?1:0});return this},addArrayCondition:function(b,a){if(!1===a||null==b)return this;p=null;c=c.concat(b);return this},addCondition:function(b,a,d,k,e){if(!1===k)return this;b=aa(b,a,d);null!=b&&(c.push(b),p=null);return this},addComplexCondition:function(b){c.push(b)},open:function(c,a,d){c=b.localQueryable("",c,d);c.father=this;return c},close:function(b){if(null==(this.father||null))return this;var c=this.getFilter();null!=c&&b&&this.father.addComplexCondition(c);
return this.father}});g.validator&&g.validator.objectHasErrors&&(R.selectErrors=function(){R.resetFilter();c.push(G);p=null;return this});return R};b.retrievalManager=function(a,d,k,e){function l(){if(e.subtractViewModel&&e.updatesManager){b.utils.isArray(e.subtractViewModel)&&(e.subtractViewModel={prop:e.subtractViewModel});var c=e.dataTransform;e.dataTransform=function(a){var d=[];b.utils.visitModel(e.subtractViewModel,function(b,c,a){(b=c._oldValue_)&&(b=b().up)&&b==e.updatesManager&&d.push(c)},
!0,!0);d=e.updatesManager.arrayDiff(a,d);return c(d)}}}var m=null,c=null,h=null,r=null,B=!1,q=null,p=null,A=null,J=null;e=e||{};e=g.extend({},{immediateSubmit:!0,pageSize:1E6,expression:null,data:null,updatesManager:null,entitiesContainer:null,auxLocal:null,finalContainer:null,resultsField:"Results",countField:"TotalCount",jFormsToClear:null,onSubmit:function(b){},htmlStatusMessages:function(b,c){return c},onAfterError:function(b,c,a,d){},onError:function(c,a,d,k){if(this.jFormsToClear&&0!=this.jFormsToClear.length){var e=
{errors:[{name:"",id:"",errors:[this.htmlStatusMessages(a.status,k)]}]};this.jFormsToClear.each(function(){b.updatesManager.utils.refreshErrors(g(this),e)});this.onAfterError(c,a,d,k)}},dataTransform:function(b){return b},onAfterSuccess:function(b,c){},subtractViewModel:null,pageObservable:null,onSuccess:function(c,e,l,h){A&&(J=c.lastState);A&&!c.isCache&&A.add(c.lastState,{evt:c,x:e,status:l});c.page||(c.page=d?d():1);if(!e)e={},e[this.resultsField]=[],e[this.countField]=0;else if(e.d)e=e.d;else if(b.utils.isArray(e)){var m=
{};m[this.resultsField]=e;m[this.countField]=(c.page+1)*this.pageSize;e=m}if(0==e[this.resultsField].length)if(e[this.countField]<(c.page-1)*this.pageSize+1)e[this.countField]=(c.page-1)*this.pageSize+1;else{if(c.previousPage&&c.previousPage<c.page){d&&d(c.previousPage);k&&k(2>c.page?1:c.page-1);this.onAfterSuccess(c,e,l,h);return}e[this.countField]=0}m=a.isLocal()?this.dataTransform(e[this.resultsField]):n.mapping.fromJS(this.dataTransform(e[this.resultsField]))();this.updatesManager&&!a.isLocal()&&
this.updatesManager.prepare(m,!0,!1,!1);if(!a.isLocal()){var r=this.entitiesContainer();this.entitiesContainer([]);if(r&&b.ko&&b.ko.unfreeze)for(var q=0;q<r.length;q++)b.ko.unfreeze(e)}this.entitiesContainer(m);k&&(m=Math.floor(e[this.countField]/this.pageSize),e[this.countField]%this.pageSize&&m++,0==m&&(m=1),k(m));var p=this;p.auxLocal&&(p.auxLocal.setPaging(1,p.pageSize),"sort"==c.type&&p.auxLocal.importSorting(c.sortString),p.auxLocal.execute(function(b){p.finalContainer(b.Results)}));p.updatesManager&&
p.jFormsToClear?a.isLocal()?p.jFormsToClear.each(function(){p.updatesManager.refreshErrors(g(this),null,{refreshNewControls:!0})}):p.jFormsToClear.each(function(){p.updatesManager.clearUpdaterErrors(g(this))}):p.jFormsToClear&&(b.basicKo.serverErrors(),p.jFormsToClear.each(function(){for(var c=b.updatesManager.global,a=0;a<c.length;a++)c[q].isErrorMaster()&&c[q].refreshErrors(g(this))}));this.onAfterSuccess(c,e,l,h)}},e);l();return{newCache:function(c){A=b.utils.cache(c)},getCache:function(){return A},
invalidateCurrentCache:function(){A&&J&&A.remove(J)},options:function(c){e=g.extend(e,c);l()},optionsSetting:function(c){return e[c]},submit:function(c,b){var k={cancel:!1};e.onSubmit(k,c,e.data);if(k.cancel)r&&(e.pageSize=r,e.pageObservable&&e.pageObservable(e.pageSize)),h&&(a.setState(h),a.setPaging(h.page,e.pageSize),d&&d(h.page)),h=null;else{if(A){c.lastState=JSON.stringify(a.getState(!0));if(k=A.get(c.lastState)){k.evt.isCache=!0;e.onSuccess(k.evt,k.x,k.status,null);return}c.isCache=!1}a.execute(function(b,
a,d){e.onSuccess(c,b,a,d)},function(b,a,d){e.onError(c,b,a,d)},b)}},changePageSize:function(c){e.pageSize=c;a.setPage(c)},entitiesContainer:function(){return e.entitiesContainer},pipe:function(c,b){p=c;a.isLocal()&&a.changeSource(c.entitiesContainer());b&&this.submit({},!0)},declareCustomEventHandler:function(c){q=c},getComponents:function(){return{queryable:a,pageSizeObservable:e.pageObservable,pageObservable:d}},getState:function(){return{pageSize:e.pageSize,queryableState:a.getState()}},setState:function(c,
b){e.pageSize=c.pageSize;option.pageObservable&&option.pageObservable(e.pageSize);a.setState(c);a.setPaging(c.page,e.pageSize);d&&d(c.page);b&&this.submit({},!0)},event:function(b,k){h=a.getState();"errors"==b.type&&(c=e.pageSize);r=e.pageSize;B&&"page"!=b.type&&(B=!1,c&&(e.pageSize=c,e.pageObservable&&e.pageObservable(e.pageSize)),m&&(a.setState(m),"refresh"==b.type&&(b.page=m.page)));if("refresh"==b.type)this.submit(b,!0);else if("custom"==b.type)q&&q(this,b,a,d);else{if("filter"==b.type||"errors"==
b.type)b.page=1,d&&d(1);"pull"==b.type?p&&(b.toPull&&p.event(b.toPull,!0),b.immediatePull&&p.submit(b.toPull||{},!0)):(e.pageSize=b.itemsPerPage||e.pageSize,e.pageObservable=b.pageSizeObservable,a.setPaging(b.page,e.pageSize),"sort"==b.type?a.importSortingInfos(b.sorterInfos):"filter"==b.type?a.resetFilter().importClauses(b.filterPrefix):"errors"==b.type&&a.isLocal()&&(m=a.getState(),B=!0,a.selectErrors()),e.immediateSubmit&&!e.noSubmit&&this.submit(b))}}}};b.clientsubmit={_queue_:[],register:function(b){this._queue_.push(b)},
execute:function(){for(var b=0;b<this._queue_.length;b++)this._queue_[b]()}};var E=function(a,d,k,e,l,m,c){function h(){this.collections=[]}function r(u,F,f){F||(F=[],F.root=f);u||(u=b.utils.property(d,k));if(c.children)for(f=0;f<c.children.length;f++){var a=F["_"+c.children[f].updater.getId()],e=!1,w=!1;a||(F.root==c.children[f].updater?(a=c.children[f].updater.getData(),w=!0):a=[],e=!0,F["_"+c.children[f].updater.getId()]=a);for(var g=c.children[f].expression,x=0;x<u.length;x++)if(c.processChildren(u[x])&&
!u[x]._destroy){var s=b.utils.property(u[x],g);b.utils.isArray(s)&&(a.push.apply(a,s),c.children[f].updater.copyChildrenRecursive(s,F))}e&&c.children[f].updater.newSource(a,w)}}function B(b){b||(b=[]);if(!b["_"+K]){b["_"+K]=!0;if(c.isChild&&T){var F=l;m&&(F=property(l,m));for(var f=[],a=0;a<T.length;a++){var d=T[a];void 0!==d._fatherReference?f.push(d._fatherReference):f.push(-1)}F[c.updater.f]=f}if(c.children)for(a=0;a<c.children.length;a++)c.children[a].updater.computeFatherReferences(b)}}function q(c){var a=
b.utils.property(d,k);b.utils.visitModel(a,function(b,a,F){(F=a._oldValue_)&&(F=F().up)&&F.pushChange(a,b,!0,c)},!0,!0)}function p(u){var a=U;a||(a=b.utils.property(d,k));if(b.utils.isArray(a)){for(var f=[],S=[],ba=[],w=[],g=[],x=[],s=[],h=[],p=!1,q=0,r=0;r<a.length;r++){var y=n.utils.unwrapObservable(a[r]),v,z=y._oldValue_;z&&(z=z());if(v=n.utils.unwrapObservable(y._inserted)){f.push(b.utils.updateCopy(y));x.push(y);w.push(y.ModelPrefix+"["+y._tag);p=!0;Q.validate(u,y);if(c.children)for(v=0;v<c.children.length;v++)if(z=
b.utils.property(y,c.children[v].expression),b.utils.isArray(z))for(var t=0;t<z.length;t++)z[t]._fatherReference=q;q++}else if(v=y._destroy)z&&z.ph||(S.push(b.utils.property(y,e)),p=!0);else if(v=n.utils.unwrapObservable(y._modified),c.automodified||v)b.utils.changed(y)?(Q.validate(u,y),s.push(y),ba.push(b.utils.updateCopy(y)),g.push(y.ModelPrefix+"["+y._tag),p=!0):y._modified(!1)}u=!1;a={};a[c.updater.i]=f;a[c.updater.ei]=[];a[c.updater.eu]=[];a[c.updater.u]=ba;a[c.updater.d]=S;c.isChild&&(a[c.updater.f]=
h);N=a;m?(l||(l={},u=!0),b.utils.propertySet(l,m,a)):(l||(u=!0),l=a);T=x;return V={changes:p,i:w,u:g,_justCreated_:u,inserted:x,updated:s}}}function A(b,a,f){if(c.processChildren(b)&&c.children)for(a=0;a<c.children.length;a++){var d=c.children[a];d.updater.resetAll(null,b,d.expression,f)}}function J(b,c){return c?-1<b._tag?b.ModelPrefix+"["+b._tag+"]":null:b.ModelPrefix}function R(c,a){if(c&&c.errors){var f=[],S=m?b.utils.property(l,m):l;for(M=0;M<c.errors.length;M++)if(curr=c.errors[M],curr._pocessed||
!curr.name)f.push(curr);else{if(m&&""!=curr.name){var e=curr.name.indexOf(m);if(0<=e&&(0==e||e==curr.name.indexOf(".")+1))0<e&&(curr.name=curr.name.substring(e),curr.id=b.utils.idFromName(curr.name));else{f.push(curr);continue}}else if(!m&&""!=curr.name)e=curr.name.indexOf("."),0<=e&&!S[curr.name.substring(0,e)]&&(curr.name=curr.name.substring(e+1),curr.id=b.utils.idFromName(curr.name));else if(""==curr.name){f.push(curr);continue}curr._processed=!0;curr.updater="u"+K;if(m&&0!=curr.name.indexOf(m))f.push(curr);
else{var w=m?curr.name.substring(m.length+1):curr.name,g=S;k&&(w=k+"."+w,g=d);if(w){for(var e=w.split(/[\[\.\]]+/),x=[],s=0;s<e.length;s++)e[s]&&x.push(e[s]);for(var h=null,p=e=null,s=0;s<x.length;s++)h=b.utils.isArray(g),b.utils.isObject(g)&&g.ModelPrefix&&(e=w,p=g),g=g[h?parseInt(x[s]):x[s]],g=n.utils.unwrapObservable(g),h=b.utils.isArray(g),w&&!h&&(h=w.indexOf("."),w=0<=h?w.substring(h+1):null);b.utils.isArray(g);b.utils.isObject(g)&&g.ModelPrefix&&(e=w,p=g);p?(w={_processed:!0,errors:curr.errors,
name:[],id:[],updater:"u"+K},g=(g=J(p,!0))?g+(e?"."+e:""):J(p,!1)+(e?"."+e:""),w.name.push(g),w.id.push(b.utils.idFromName(g)),f.push(w)):f.push(curr)}else f.push(curr)}}c.errors=f}}function D(u,a,f){if(u)for(iPrefix=m?m+"."+c.updater.i:c.updater.i,uPrefix=m?m+"."+c.updater.u:c.updater.u,f=0;f<u.length;f++)if(!u[f]._pocessed){var d=u[f].name.indexOf(uPrefix),e=u[f].name.indexOf(iPrefix);if(""!=u[f].name){if(0<=e&&(0==e||e==u[f].name.indexOf(".")+1))0<e&&(u[f].name=u[f].name.substring(e));else if(0<=
d&&(0==d||d==u[f].name.indexOf(".")+1))0<d&&(u[f].name=u[f].name.substring(d));else continue;(d=b.utils.changeIndex(iPrefix,"",u[f].name,function(b){if(b>=a.i.length)return null;g.validator.declareServerError&&b<a.inserted.length&&g.validator.declareServerError(a.inserted[b]);return a.i[b]}))||(d=b.utils.changeIndex(uPrefix,"",u[f].name,function(b){if(b>=a.u.length)return null;g.validator.declareServerError&&b<a.updated.length&&g.validator.declareServerError(a.updated[b]);return a.u[b]}));d&&(d=d.substring(1),
u[f]._pocessed=!0,u[f].name=d,u[f].id=b.utils.idFromName(d),u[f].updater="u"+K)}}}function E(u,d,f){if(d)$=f;else{if(!a)throw"updateUrl is not optional";d=n.mapping.toJS(l);d=b.utils.stringify(d,c.isoDate);d={url:a,contentType:"application/json",data:d,dataType:"text",type:"POST",success:function(c,a,d){c=g.parseJSON(c);c?c.errors&&b.utils.isArray(c.errors)&&0==c.errors.length?c.errors=null:c.errors||(c.errors=null):c={errors:null};f(c,u,d.status)},error:function(a,d,F){d=a.responseText||null;var e=
{};try{e=d?g.parseJSON(d):{}}catch(k){}b.utils.isArray(e)&&(e={errors:e});e.errors||(e.errors=null);b.utils.isArray(e.errors)&&0==e.errors.length&&(e.errors=null);e.errors||(e.errors=[{name:"",id:"",errors:[c.htmlStatusMessages(a.status,F)]}]);f(e,u,a.status)}};var e=null,k=null;b.ko&&b.ko.dynamicTemplates&&b.ko.dynamicTemplates.authorizationManager&&(k=b.ko.dynamicTemplates.authorizationManager())&&(k=k.bearerToken()||null);Z?e=Z:k&&(e={Authorization:"Bearer "+k});Z&&k&&!e.Authorization&&""!==e.Authorization&&
(e.Authorization="Bearer "+k);e&&(d.headers=e);g.ajax(d)}}function t(u,a,f,d){if(u)for(var e=0;e<a.length;e++){var k=a[e],g=d;if(k.children)void 0!==k.U&&c.updatersIndices&&0<=k.U&&k.U<c.updatersIndices.length&&(g=c.updatersIndices[k.U]),t(b.utils.propertyComplete(u,k.destinationExpression,!0),k.children,f,g);else if(k.destinationExpression){void 0!==k.U&&c.updatersIndices&&0<=k.U&&k.U<c.updatersIndices.length&&(g=c.updatersIndices[k.U]);var h=k.newValue;if(h){var l=b.utils.classof(h);if("array"==
l||"object"==l)h=n.mapping.fromJS(h),!g&&c.classifyEntity&&(g=c.classifyEntity(h)),g&&g.prepare(h,!0,!1,!1,null,!0)}b.utils.propertySetComplete(u,k.destinationExpression,h)}else c.classifyEntity&&c.updatersIndices&&(k.newValue=n.mapping.fromJS(k.newValue),b.utils.visitModel(k.newValue,function(b,a,u){((up=c.classifyEntity(a))||0===up)&&up<c.updatersIndices.length&&c.updatersIndices[up].prepare(a,!0,!1,!1,null,!0)},!0,!0)),f?n.mapping.fromJS(k.newValue,f,u):n.mapping.fromJS(k.newValue,{},u)}}function G(u){if(!u||
0==u.length)if(u=g("#_DynamicJSonFormtoSubmit_"),0==u.length){if(!a)throw"updateUrl is not optional";g("body").first().prepend("<form id='_DynamicJSonFormtoSubmit_' action='"+a+"' method='post'><input type='hidden' name='display.$$' value='MVCControlsToolkit.Controls.Bindings.JSONAdapter' /><input type='hidden' name='$.JSonModel' value='' class='JSonModeltoSubmit' /></form>");u=g("#_DynamicJSonFormtoSubmit_");u.find(".JSonModeltoSubmit").val(b.utils.stringify(n.mapping.toJS(l),c.isoDate))}u.submit()}
function O(a,e){null==a&&(a=b.utils.property(d,k));if(b.utils.isArray(a))for(var f=0;f<a.length;f++)if(c.children&&c.processChildren(a[f]))for(var g=0;g<c.children.length;g++){var h=b.utils.property(a[f],c.children[g].expression);if(b.utils.isArray(h)){for(var w=[],l=!1,m=0;m<h.length;m++)h[m]._destroy?(l=!0,c.dispose(h[m])):w.push(h[m]);l&&b.utils.propertySet(a[f],c.children[g].expression,w);e&&c.children[g].updater.removeDeletedChildren(h,!0)}}}function L(c,a){a||(a={});var f="u"+c.getId();if(!a[f]&&
(a[f]=!0,f=c.optionsSetting("children"))){b.utils.isArray(f)||(f=[f]);for(var d=0;d<f.length;d++)L(f[d].updater,a)}return a}function C(b,a){if(!g.validator.getObjectInErrorList||Q.validate(b))return!0;var f=g.validator.getObjectInErrorList(b),d=g.validator.objectErrors(b);d&&(I=d,a||Q.refreshErrors(b));c.onObjectErrors(f);return!1}var Z=null;h.prototype={collections:null,add:function(b,c){b._to_process_=!0;c._oldValue_().toUndo=!0;this.collections.push(b)},process:function(){for(var a=0;a<this.collections.length;a++){var d=
this.collections[a];if(d._to_process_){d._to_process_=!1;for(var f=d(),e=[],k=0;k<f.length;k++){var g=f[k]._oldValue_;g&&(g=g());if(g.toUndo){g=g.ph;g._modified(!1);b.utils.undo(g);var h=g._oldValue_();h.pph=!1;h.pc=!1;g._modified(!1);g._destroy&&c.destroy(g,!1);e.push(g)}else e.push(f[k])}d(e)}}}};var P=[];if(!e)throw"keyExpression is not optional";c=c||{};var N=null,K=b.updatesManager._count,T=null,U=null;b.updatesManager._count++;var $=null,I=null,W=!1,V=null,X=null;c=g.extend({},{updater:{u:"Modified",
eu:"ExternalModified",i:"Inserted",ei:"ExternalInserted",d:"Deleted",f:"FatherReferences"},onUpdateStart:function(b){},onUpdateComplete:function(b,c,a){},updateCallback:function(b,c,a){},updatingCallback:function(b,c,a){return!0},prepareCallback:function(b){},isChild:!1,automodified:!1,destroy:function(b,c,a){c&&a?a.destroy(b):b._destroy=c},htmlStatusMessages:function(b,c){return c},dispose:b.ko&&b.ko.unfreeze?b.ko.unfreeze:function(b){},processChildren:function(b){return!0},updatersIndices:null,
classifyEntity:null,objectKey:!1,Errors:function(){return null},itemErrors:function(b){return null},onObjectErrors:function(b){}},c);if(c.children){b.utils.isArray(c.children)||(c.children=[c.children]);for(var M=0;M<c.children.length;M++)P[c.children[M].expression]=c.children[M]}var Q={childrenLookUp:function(b){return P[b]},arrayDiff:function(a,d,f){return b.utils.arrayDiff(a,d,e,c.objectKey,f,!0)},declareHeaders:function(b){Z=b},removeDeleted:function(){var a=b.utils.property(d,k);if(b.utils.isArray(a)){for(var e=
[],f=0;f<a.length;f++)a[f]._destroy?c.dispose(a[f]):e.push(a[f]);b.utils.propertySet(d,k,e)}c.children&&0<c.children.length&&O(null,!0)},removeDeletedChildren:O,copyChildrenRecursive:function(b,c){r(b,c,this)},computeFatherReferences:B,getId:function(){return K},getData:function(){var b=property(d,k);return b?b.slice():[]},options:function(b){c=g.extend(c,b)},optionsSetting:function(b){return c[b]},declareChild:function(){c.isChild=!0},modelTracking:function(c,a){var f=k?b.utils.property(d,k):d;X=
c?b.utils.cloneDeep(f):null},hasChanges:function(a,e){var f=null,g=null;a&&e&&(f=property(a,e,!0));g=f||b.utils.property(d,k);g=n.utils.unwrapObservable(g);for(f=0;f<g.length;f++){var h;a:if(h=g[f],n.utils.unwrapObservable(h._inserted)||h._destroy||(n.utils.unwrapObservable(h._modified)||c.automodified)&&b.utils.changed(h))h=!0;else{if(c.children)for(var w=0;w<c.children.length;w++){var l=c.children[w];if(l.updater.hasChanges(h,l.expression)){h=!0;break a}}h=!1}if(h)return!0}return!1},filterObservable:function(a,
e,f){if(e=e||b.utils.property(d,k,!0)){var g=null;a&&(g=a["_"+K]);var h=null;f&&(h=f["_"+K]);if(g||h){this.arrayDiff(e,g,h);if(c.children)for(f=e(),g=0;g<f.length;g++)for(var h=f[g],l=0;l<c.children.length;l++){var m=c.children[l];m&&m.updater&&m.updater.filterObservable(a,b.utils.property(h,m.expression,!0))}return e}}},pushChange:function(a,d,f,k){N&&(n.utils.unwrapObservable(a._inserted)?(this.validate(k,a),k=b.utils.updateCopy(a),f||N[c.updater.i].push(k),T.push(k),N[c.updater.ei].push(d),V.i.push(a.ModelPrefix+
"["+a._tag),V.changes=!0):a._destroy?f||N[c.updater.d].push(b.utils.property(a,e)):(c.automodified||n.utils.unwrapObservable(a._modified))&&b.utils.changed(a)&&(this.validate(k,a),f||N[c.updater.u].push(b.utils.updateCopy(a)),N[c.updater.eu].push(d),V.u.push(a.ModelPrefix+"["+a._tag),V.changes=!0))},addChildUpdateManager:function(a,d,f){c.children||(c.children=[]);c.children.push(a);P[a.expression]=a;!a.updater&&d&&f&&(l||(l={}),a.updater=b.updatesManager(null,null,null,d,l,f));a.updater.declareChild();
return a.updater},unprepare:function(a){if(a){a=n.utils.unwrapObservable(a);b.utils.isArray(a)||(a=[a]);for(var d=0;d<a.length;d++){var f=a[d];delete f._inserted;delete f._modified;delete f._destroy;delete f.ModelPrefix;delete f.ModelId;delete f._tag;delete f._oldValue_;delete f._errorStatus;delete f.__instance_errors__}if(c.children)for(a=0;a<c.children.length;a++)c.children[a].updater.unprepare(b.utils.property(f,c.children[a].expression))}},prepare:function(d,e,f,g,h,l){if(d){d=n.utils.unwrapObservable(d);
b.utils.isArray(d)||(d=[d]);for(var m=0;m<d.length;m++){var x=d[m];x._inserted||(x._inserted=n.observable(!1));x._modified||(x._modified=n.observable(!1));l&&x._modified(!0);e&&b.utils.Track(x,f,g,this);b.updatesManager.utils.prepare(x,h||k,!b.basicKo.serverErrorsLast&&(c.isChild||a&&"dummy"!=a));if(c.children)for(var s=0;s<c.children.length;s++){var p=x.ModelPrefix+"["+x._tag+"]."+c.children[s].expression;c.children[s].updater.prepare(b.utils.property(x,c.children[s].expression),e,f,g,p)}c.prepareCallback(x)}}},
getObjectLevelerrors:function(a){return a?c.itemErrors(a):(a=d&&k?b.utils.property(d,k):U)?c.Errors(a):null},validate:function(c,a){if(!g.validator.objectHasUnobtrusiveErrors)return!0;if(a){if(g.validator.objectHasUnobtrusiveErrors(a))return g.validator.addObjectToErrorList(c,a),g.validator.addObjectError(c,g.validator.getEntityErrors(a)),!1;var f=this.getObjectLevelerrors(a);if(f){var d=J(a,!0);g.validator.markEntityInError(a,{_processed:!0,errors:f,name:d,id:b.utils.idFromName(d)},c);g.validator.addObjectToErrorList(c,
a);return!1}return!0}(f=g.validator.objectErrors(c))&&(f=f.errors);return f&&0<f.length?!1:(f=this.getObjectLevelerrors())?(g.validator.addObjectError(c,{_processed:!0,errors:f,name:"",id:""}),!1):!0},newSource:function(c,a){d&&k&&!a?b.utils.propertySet(d,k,c):U=c},isErrorMaster:function(){return W},refreshErrors:function(c,a,d){a||(a=I);b.updatesManager.utils.refreshErrors(c,a,d)},clearErrors:function(b,c){this.refreshErrors(b,{errors:null});c&&I&&(I.errors=null)},clearUpdaterErrors:function(b){var c=
L(this);if(I&&I.errors){for(var a=[],d=0;d<I.errors.length;d++){var e=I.errors[d];e.updater&&c[e.updater]||a.push(e)}I.errors=a}this.refreshErrors(b)},modified:function(c,a,d,e,k){var g=n.utils.unwrapObservable(c);n.utils.unwrapObservable(g._inserted)||g._destroy||(d?g._modified(b.utils.changed(c)):a?(g._modified(!0),b.utils.Track(c,e,k)):g._modified(!0))},inserted:function(b,c){var a=n.utils.unwrapObservable(c);b.push(c);a._inserted(!0)},deleted:function(b,c,a,d){this._deleted(b,c,a);this.refreshErrors(d,
g.validator&&g.validator.objectErrors?g.validator.objectErrors(d):null,{prefixToRemove:c})},_deleted:function(a,d,f){var e=n.utils.unwrapObservable(d);if(f&&c.children)for(var k=0;k<c.children.length;k++){var g=b.utils.property(d,c.children[k].expression,!0);if(g)for(var h=n.utils.unwrapObservable(g),l=0;l<h.length;l++)n.utils.unwrapObservable(h),h[l]._destroy||c.children[k].updater._deleted(g,h[l],f)}n.utils.unwrapObservable(e._inserted)?(c.dispose(e),a.remove(e)):c.destroy(e,!0,a);e._last_detail_&&
e._last_detail_()(null)},arrayChanged:function(b){return n.computed(function(){for(var c=n.utils.unwrapObservable(b),a=0;a<c.length;a++){var d=c[a];if(d._destroy||d._inserted()||d._modified())return!0}return!1})},accepted:function(a){a=n.utils.unwrapObservable(a);var d=a._destroy||a._inserted()||a._modified();c.destroy(a,!1);a._inserted(!1);a._modified(!1);d&&(d=a._oldValue_)&&(d=d(),d.ph=!1,d.pph=!1,d.pc=!1,b.utils.restoreEntity(a,d.value,d.vr))},newKey:function(a,d,f){f=f||e;b.utils.propertySet(a,
f,d);if(c.children)for(f=0;f<c.children.length;f++){var k=c.children[f],g=b.utils.property(a,k.expression);if(g)for(j=0;j<g.length;j++)b.utils.propertySet(g[j],k.external,d)}},externalOf:function(b){return(b=P[b])?b.external:null},updaterOf:function(b){return(b=P[b])?b.updater:null},moveChild:function(b,c,a,d,e,k,g,h){this.addChild(c,a,d,!1,e,k,g,b,h)},move:function(b,c,a,d,e){this.addChild(null,null,c,!1,null,a,d,b,e)},add:function(b,c,a,d,e,k){this.addChild(null,null,b,c,a,d,e,null,k)},addChild:function(a,
g,f,h,l,m,p,x,s){var q=null,r=!1,t=null,H=null;c.isChild&&b.utils.currentModel&&!a&&0==g.indexOf("#@.")&&(a=b.utils.currentModel,g=g.substring(3),q=(q=a._oldValue_)&&q().up?q().up.childrenLookUp(g):{updater:this},r=!1);a&&g?(q=q||P[g],t=property(a,g,!0),H=n.utils.unwrapObservable(t),b.utils.isArray(H)||(H=[],t=n.observableArray(H),propertySet(a,g,t,!0)),q||(q={updater:this},r=!0)):(r=!0,t=property(d,k,!0),H=n.utils.unwrapObservable(t),b.utils.isArray(H)||(H=[],t=n.observableArray(H),propertySet(d,
k,t,!0)),q={updater:this});if(q){var y=null;!h&&x&&(y=x());var v=f._oldValue_;H!=y?(y=null,r||(y=a.ModelPrefix+"["+a._tag+"]."+g),v?(v=v(),q.updater.prepare(f,!0,v.vr,v.ca,y)):(q.updater.prepare(f,!0,!1,!1,y),v=f._oldValue_())):v=v();if(!h&&x){y=x();g=null;f._inserted()||v.pph||(g=b.utils.cloneEntity(f,v.vr,v.ca));for(var z=[],B=0;B<y.length;B++){var A=n.utils.unwrapObservable(y[B]);A!=f?z.push(A):null!=g&&z.push(g)}if(g){var D={value:v.value,vr:v.vr,ca:v.ca,ph:f};g._oldValue_=function(){return D};
v.pph=g;v.pc=x;c.destroy(g,!0);g._modified(!1);f._inserted(!1);f._modified(!0)}H==y&&(H=z);x(z)}r||(a=property(a,l||e),propertySet(f,q.external,a));if(m){z=[];p||z.push(f);for(B=0;B<H.length;B++)A=n.utils.unwrapObservable(H[B]),A==p?s?(z.push(f),z.push(A)):(z.push(A),z.push(f)):z.push(A);t(z)}else H.push(f),t(H);h&&f._inserted(!0)}},newResult:function(b,c){if($){var a=$;$=null;a(b,this,c)}},reset:function(a,e,f,l){this.modified(a,!0,!0);var m=new h;if(n.utils.unwrapObservable(a._modified)){var w=
a._oldValue_;w&&(w=w());w.pph&&w.pc?(f=f?f:b.utils.property(d,k,!0),f.remove(a),m.add(w.pc,w.pph)):(b.utils.undo(a),a._modified(!1))}else n.utils.unwrapObservable(a._inserted)&&(f=f?f:b.utils.property(d,k,!0),c.dispose(a),f.remove(a));l||A(a,null,m);m.process();g.validator&&g.validator.ClearEntityErrorState&&g.validator.ClearEntityErrorState(a);e&&this.refreshErrors(e,null,{prefixToRemove:a})},addRelated:function(c,a,f,g,h){var l=b.utils.property(d,k);if(l){h=h||e;a=n.utils.unwrapObservable(a);b.utils.isArray(a)||
(a=[a]);for(var m=[],p=0;p<a.length;p++){var s=b.utils.property(a[p],f),q=m[s];q?q.push(a[p]):m[s]=[a[p]]}for(p=0;p<l.length;p++)if(a=m[b.utils.property(l[p],h)],f=b.utils.property(l[p],c,!0),a){if(n.isObservable(f)?(s=n.utils.unwrapObservable(f),s.push.apply(s,a),f(s)):f&&b.utils.isArray(f)?f.push.apply(f,a):b.utils.propertySet(l[p],c,n.observableArray(a)),g)for(f=0;f<a.length;f++)s=b.utils.property(a[f],g,!0),n.isObservable(s)?s.push(l[p]):s&&b.utils.isArray(s)?s.push(l[p]):b.utils.propertySet(a[f],
g,n.observableArray([l[p]]))}else f||b.utils.propertySet(l[p],c,n.observableArray([]))}},resetAll:function(a,e,f,l){var m=null,p=null,q=!1;l||(l=new h,q=!0);e&&f&&(m=property(e,f,!0));p=m||b.utils.property(d,k);if(p=n.utils.unwrapObservable(p)){f=[];for(var x=0;x<p.length;x++){var s=p[x],r=s._oldValue_;r&&(r=r());if(r&&r.pph&&r.pc)l.add(r.pc,r.pph);else if(n.utils.unwrapObservable(s._inserted))c.dispose(s);else{if(s._destroy){if(!r||!r.ph)if(c.destroy(s,!1),c.automodified||n.utils.unwrapObservable(s._modified))b.utils.undo(s),
s._modified(!1)}else if(c.automodified||n.utils.unwrapObservable(s._modified))b.utils.undo(s),s._modified(!1);f.push(s);g.validator&&g.validator.ClearEntityErrorState&&g.validator.ClearEntityErrorState(s);A(s,null,l)}}q&&l.process();m?(m(f),this.refreshErrors(a,null,{prefixToRemove:e.ModelPrefix+"["+e._tag+"]"})):(I=null,b.utils.propertySet(d,k,f),a&&this.refreshErrors(a))}},submit:function(a,e,f,g){c.updatersIndices&&(f=f||c.updatersIndices);if(!e)c.onUpdateStart(d);var k=!1;if(f){b.utils.isArray(f)||
(f=[f]);for(var h=0;h<f.length;h++)f[h].submit(a,!0)&&(k=!0)}f=!1;g||(g=[],g.root=this,f=!0);if(g["_"+K])return!1;g["_"+K]=!0;f&&r(null,null,this);var n=p(a);k&&(n.changes=!0);if(c.children)for(h=0;h<c.children.length;h++)c.children[h].updater.submit(a,!0,null,g)&&(n.changes=!0);if(!C(a,e))return!1;f&&B();return n.changes&&c.updatingCallback(n.changes,l,m)?!e&&n.changes?(G(a),!0):n.changes:!1},submitComplexModel:function(a,e,f){c.updatersIndices&&(f=f||c.updatersIndices);if(!e)c.onUpdateStart(d);
if(f){b.utils.isArray(f)||(f=[f]);for(var g=0;g<f.length;g++)f[g].submit(a,!0)}f=k?b.utils.property(d,k):d;q(a);if(!C(a,e))return!1;f=X?[X,f]:f;l||(l=f);l&&m?b.utils.propertySet(l,m,f):l=f;e||G(a);return!0},update:function(a,h,f,q,t){h&&(t=q,q=!1);c.updatersIndices&&(f=f||c.updatersIndices,q=!0);var w=!1;if(!h)c.onUpdateStart(d);if(!h&&q&&f)for(b.utils.isArray(f)||(f=[f]),q=0;q<f.length;q++)f[q].update(a,!0)&&(w=!0);var A=!1;t||(t=[],t.root=this,A=!0);if(t["_"+K])return!1;t["_"+K]=!0;A&&r(null,null,
this);var x=p(a);w&&(x.changes=!0);if(c.children)for(q=0;q<c.children.length;q++)c.children[q].updater.update(a,!0,null,t)&&(x.changes=!0);if(!C(a,h))return!1;A&&B();if(!h&&!x.changes||!c.updatingCallback(x.changes,l,m))return!1;E(this,h,function(l,p,q){if(x.changes){l.errors&&D(l.errors,x,a);var r={setErrors:!0,model:d,expression:k,key:e,success:!l.errors};c.updateCallback(r,l,q);I=l;!h&&g.validator&&g.validator.setObjectErrors&&g.validator.setObjectErrors(a,I);if(!l.errors){var w=t,y=U;y||(y=b.utils.property(d,
k));if(b.utils.isArray(y)){if(l&&l.insertedKeys)if(b.utils.isArray(l.insertedKeys))for(var v=0;v<l.insertedKeys.length;v++){var z=l.insertedKeys[v];if(z&&(!m||m==z.destinationExpression)){if((z=z.keys)&&z.length)for(var z=n.utils.unwrapObservable(n.mapping.fromJS(z)),B=x.inserted,C=0;C<z.length;C++)p.newKey(B[C],z[C]);break}}else if(b.utils.isObject(l.insertedKeys)&&(z=l.insertedKeys[m]))for(z=n.utils.unwrapObservable(n.mapping.fromJS(z)),B=x.inserted,C=0;C<z.length;C++)p.newKey(B[v],z[C]);for(v=
0;v<y.length;v++)y[v]._destroy||p.accepted(y[v]);if(w&&w.root==p&&d&&k&&(w.root=null,w=b.utils.property(d,k),b.utils.isArray(w))){y=[];for(v=0;v<w.length;v++)w[v]._destroy?c.dispose(w[v]):y.push(w[v]);b.utils.propertySet(d,k,y)}}}U=null;if(c.children){for(v=0;v<c.children.length;v++)c.children[v].updater.newResult(l,q);!l.errors&&A&&O(null,!0)}if(f)for(b.utils.isArray(f)||(f=[f]),v=0;v<f.length;v++)f[v].newResult(l,q);r.setErrors&&!h?(p.refreshErrors(a,l),W=!0):W=!1;if(!h)c.onUpdateComplete(r,l,q)}});
return x.changes},updateComplexModel:function(a,e,f,h){c.updatersIndices&&(f=f||c.updatersIndices,h=!0);if(h&&f)for(b.utils.isArray(f)||(f=[f]),h=0;h<f.length;h++)f[h].update(a,!0);var p=k?b.utils.property(d,k):d;q(a);if(!C(a,e))return!1;h=X?[X,p]:p;l||(l=h);l&&m?b.utils.propertySet(l,m,h):l=h;if(!e)c.onUpdateStart(d);E(this,e,function(h,l,m){var q={setErrors:!0,model:d,expression:k,success:!h.errors};c.updateCallback(q,h,m);I=h;!e&&g.validator&&g.validator.setObjectErrors&&g.validator.setObjectErrors(a,
I);R(h,a);h.errors||(b.utils.visitModel(p,function(a,c,d){"object"==d&&c.ModelPrefix&&b.updatesManager.utils.accepted(c,!0)},!0,!0),h.modelChanges&&0<h.modelChanges.length&&t(p,h.modelChanges,c.mapping));if(f){b.utils.isArray(f)||(f=[f]);for(var n=0;n<f.length;n++)f[n].newResult(h,m)}q.setErrors&&!e?(l.refreshErrors(a,h),W=!0):W=!1;if(!e)c.onUpdateComplete(q,h,m)});return!0}};b.updatesManager.all.push(Q);return Q};b.updatesManager=function(a,b,g,e,h,m,c){a=E(a,b,g,e,h,m,c);delete a.submitComplexModel;
delete a.updateComplexModel;delete a.modelTracking;return a};"qaxcvrfgle<1df21"==b.utils.extension&&(b.viewModelUpdatesManager=function(a,d,g,e,h,m){m||""===h||h||(m=e,e=b.utils.property(d,g),h="");a=E(a,d,g,"dummy",e,h,m);a.submit=a.submitComplexModel;a.update=a.updateComplexModel;delete a.submitComplexModel;delete a.updateComplexModel;delete a.resetAll;delete a.addRelated;delete a.reset;delete a.addChild;delete a.add;delete a.move;delete a.moveChild;delete a.updaterOf;delete a.externalOf;delete a.newKey;
delete a.arrayDiff;a.prepare=function(a,d,e,g,k){b.updatesManager.utils.prepare(a,k)};delete a.addChildUpdateManager;delete a.declareChild;delete a.getData;delete a.hasChanges;delete a.filterObservable;b.updatesManager.global.push(a);return a});b.updatesManager._count=0;b.updatesManager.utils={};b.updatesManager.all=[];b.updatesManager.global=[];b.updatesManager.utils.prepare=function(a,d,g){a=n.utils.unwrapObservable(a);b.utils.isArray(a)||(a=[a]);for(var e=0;e<a.length;e++){var h=a[e];h.ModelPrefix||
(h.ModelPrefix=d,h.ModelId=b.utils.idFromName(h.ModelPrefix),b.basicKo.newTemplateName(h,h,g))}};b.updatesManager.utils.accepted=function(a,d){var g=n.utils.unwrapObservable(a);g._inserted(!1);d?g._modified(!0):g._modified(!1);var e=g._oldValue_;e&&(e=e(),e.ph=!1,e.pph=!1,e.pc=!1,b.utils.restoreEntity(g,e.value,e.vr))};b.updatesManager.utils.prepareModel=function(a,d){b.utils.visitModel(a,function(a,b,g){(up=d(b))&&up.prepare(b,!0,!1,!1,null,!0)},!0,!0)};b.updatesManager.utils.entitiesInWorkSpace=
function(a,d){b.utils.visitModel(a,function(a,b,g){if(a=b._oldValue_)if(a=a().up)g=d["_"+a.getId()],g||(g=[],d["_"+a.getId()]=g),g.push(b)},!0,!0)};b.updatesManager.utils.refreshErrors=function(a,d,h){h=h||{};var e=h.elementRefresh,l=h.prefixToRemove,m=h.prefixToRemoveD,c=h.prefixToRemoveI,n=h.forgetFilter,r=h.detailname,B=h.newprefix;h=h.refreshNewControls;r&&(B=B||r+"_detail");var q=[],p=[],A=[],J=[],E=!1;d&&(a?d.form=a:a=d.form);if(d&&d.errors)if(l||r){if(l&&b.utils.isObject(l)){var D=l,l=D.ModelPrefix;
if(!l)return;l=l+"["+D._tag+"]"}for(D=0;D<d.errors.length>0;D++)if(b.utils.isArray(d.errors[D].name)){for(var G=!1,t=0;t<d.errors[D].name.length;t++){var Y=d.errors[D].name[t];l&&0==Y.indexOf(l)||m&&0==Y.indexOf(m)||c&&Y==c?G=!0:r&&0==Y.indexOf(r)&&(G=!0)}l?G?L=!0:q.push(d.errors[D]):G&&q.push(d.errors[D])}else l&&0==d.errors[D].name.indexOf(l)||m&&0==d.errors[D].name.indexOf(m)||c&&d.errors[D].name==c?L=!0:r&&0!=d.errors[D].name.indexOf(r)||q.push(d.errors[D]);if(l&&!L)return;n?E=!0:d.errors=q}else q=
d.errors;if(a){h||(e?a.find(".mvcct-volatile-error").removeClass("mvcct-volatile-error field-validation-error field-validation-valid").addClass("field-validation-valid"):(a.find(".input-validation-error").removeClass("input-validation-error"),a.find(".field-validation-error").removeClass("field-validation-error").addClass("field-validation-valid")));var l=a.find("[data-valmsg-summary=true]"),O=l.find("ul");h||O.empty();var L=!1;if(0<q.length){for(D=0;D<q.length;D++){var c=null,C=q[D];if(C){n=C.id;
m=C.name;if(""!=n){b.utils.isArray(n)||(C.id=[C.id],C.name=[C.name]);for(var t=0;t<C.id.length&&(n=C.id[t],m=C.name[t],r&&(m.length>r.length&&m.charAt(r.length),m=m.slice(r.length),m=B+m,n=b.utils.idFromName(m)),c=a.find("#"+n),null==c||0==c.length);t++);}c=c||(""==n?null:a.find("#"+n));null!=c&&0==c.length&&(c=a.find("#"+n+"_D"));null!=c&&0!=c.length?(e||(c.hasClass("input-validation-error")||c.addClass("input-validation-error"),t=c.attr("data-companionpostfix"),"undefined"!==typeof t&&!1!==t?(t=
g("#"+n+t),0<t.length&&!t.hasClass("input-validation-error")&&t.addClass("input-validation-error")):"TypedEditDisplay"==c.attr("data-element-type")&&(g("#"+n+"_display").hide(),g("#"+n).show())),"hidden"==c.attr("type")?E||A.push(C):E&&p.push(C),e||a.find("[data-valmsg-for='"+m+"']").each(function(a,b){var c=g(b);c.hasClass("field-validation-valid")&&c.removeClass("field-validation-valid").addClass("field-validation-error");if(replace=!1!==g.parseJSON(c.attr("data-valmsg-replace")))c.empty(),c.text(C.errors[0])})):
E||A.push(C);g.validator&&g.validator.bubbleError?g.validator.bubbleError(m,a,{id:n}):(t=m.lastIndexOf("]"),0<t&&(t=m.substring(0,t+1),a.find("[data-valmsg-for='"+t+"']").each(function(a,b){var c=g(b);c.hasClass("field-validation-valid")&&c.removeClass("field-validation-valid").addClass("field-validation-error")})));h||(t=m.replace(/_detail\[/g,"["),""!=m&&J[t]||(g.each(C.errors,function(a,b){g("<li />").html(b).appendTo(O)}),J[t]=C,L=!0))}}a.find("span.input-validation-error[data-element-type]").removeClass("input-validation-error")}if(d&&
d.errors&&!b.utils.keepServerErrors)if(E){if(0<p.length){for(j=a=0;j<q.length;j++)if(q[j]==p[a]){if(a++,a>=p.length)break}else A.push(q[j]);d.errors=A}}else d.errors=A;L?l.removeClass("validation-summary-errors validation-summary-valid").addClass("validation-summary-errors"):h||l.removeClass("validation-summary-errors validation-summary-valid").addClass("validation-summary-valid")}}})(jQuery);